{% extends "admin/base.html" %}

{% block title %}Order Details - Admin Dashboard{% endblock %}

{% block header %}Order Details{% endblock %}
{% block subtitle %}View order information and details{% endblock %}

{% block content %}
<div class="space-y-6">
  <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- Order Information -->
      <div>
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Order Information</h3>
        <div class="space-y-3">
          <div>
            <label class="block text-sm font-medium text-gray-700">Order ID</label>
            <p class="text-sm text-gray-900">#{{ order.id }}</p>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700">Status</label>
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                   {% if order.status == 'completed' %}bg-green-100 text-green-800
                   {% elif order.status == 'processing' %}bg-blue-100 text-blue-800
                   {% elif order.status == 'pending' %}bg-yellow-100 text-yellow-800
                   {% elif order.status == 'cancelled' %}bg-red-100 text-red-800
                   {% else %}bg-gray-100 text-gray-800{% endif %}">
              {{ order.status.title() if order.status else 'Unknown' }}
            </span>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700">Total Amount</label>
            <p class="text-lg font-semibold text-gray-900">${{ order.total_amount or 0 }}</p>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700">Order Date</label>
            <p class="text-sm text-gray-900">{{ order.created_at.strftime('%B %d, %Y at %I:%M %p') if order.created_at else 'N/A' }}</p>
          </div>
        </div>
      </div>
      
      <!-- Customer Information -->
      <div>
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Customer Information</h3>
        {% if order.user %}
        <div class="space-y-3">
          <div>
            <label class="block text-sm font-medium text-gray-700">Customer Name</label>
            <p class="text-sm text-gray-900">{{ order.user.username }}</p>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700">Email</label>
            <p class="text-sm text-gray-900">
              <a href="mailto:{{ order.user.email }}" class="text-[#DAAC40] hover:text-[#b89627]">{{ order.user.email }}</a>
            </p>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700">Customer Since</label>
            <p class="text-sm text-gray-900">{{ order.user.created_at.strftime('%B %d, %Y') if order.user.created_at else 'N/A' }}</p>
          </div>
        </div>
        {% else %}
        <p class="text-sm text-gray-500">No customer information available</p>
        {% endif %}
      </div>
    </div>
    
    <!-- Order Items -->
    <div class="mt-6 pt-6 border-t border-gray-200">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">Order Details</h3>
      {% if order.items %}
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Item</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Quantity</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Price</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Total</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            {% for item in order.items %}
            <tr>
              <td class="px-4 py-2 text-sm text-gray-900">{{ item.name or 'Item #' + item.id|string }}</td>
              <td class="px-4 py-2 text-sm text-gray-900">{{ item.quantity or 1 }}</td>
              <td class="px-4 py-2 text-sm text-gray-900">${{ item.price or 0 }}</td>
              <td class="px-4 py-2 text-sm font-medium text-gray-900">${{ (item.quantity or 1) * (item.price or 0) }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <div class="bg-gray-50 rounded-lg p-4">
        <p class="text-sm text-gray-500">No order items available</p>
      </div>
      {% endif %}
    </div>
    
    <!-- Order Notes -->
    {% if order.notes %}
    <div class="mt-6 pt-6 border-t border-gray-200">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">Order Notes</h3>
      <div class="bg-gray-50 rounded-lg p-4">
        <p class="text-sm text-gray-900 whitespace-pre-wrap">{{ order.notes }}</p>
      </div>
    </div>
    {% endif %}
    
    <!-- Actions -->
    <div class="flex items-center justify-between pt-6 border-t border-gray-200">
      <a href="{{ url_for('admin_orders.orders_management') }}" 
         class="inline-flex items-center px-4 py-2 bg-gray-100 text-gray-700 font-medium rounded-lg hover:bg-gray-200 transition-colors duration-200">
        <i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>
        Back to Orders
      </a>
      
      <div class="flex items-center space-x-3">
        {% if order.status != 'completed' %}
        <button onclick="updateOrderStatus('{{ order.id }}', 'completed')"
                class="inline-flex items-center px-4 py-2 bg-green-500 text-white font-medium rounded-lg hover:bg-green-600 transition-colors duration-200">
          <i data-lucide="check" class="w-4 h-4 mr-2"></i>
          Mark Complete
        </button>
        {% endif %}
        
        {% if order.status != 'cancelled' %}
        <button onclick="updateOrderStatus('{{ order.id }}', 'cancelled')"
                class="inline-flex items-center px-4 py-2 bg-red-500 text-white font-medium rounded-lg hover:bg-red-600 transition-colors duration-200">
          <i data-lucide="x" class="w-4 h-4 mr-2"></i>
          Cancel Order
        </button>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<script>
function updateOrderStatus(orderId, status) {
    if (confirm(`Are you sure you want to mark this order as ${status}?`)) {
        fetch(`/admin/api/orders/${orderId}/status`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ status: status })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('Error updating order status: ' + data.message);
            }
        })
        .catch(error => {
            alert('Error updating order status');
        });
    }
}
</script>
{% endblock %}
