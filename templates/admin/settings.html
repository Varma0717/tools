{% extends "admin/base.html" %}

{% block title %}System Settings - Admin Panel{% endblock %}

{% block header %}System Settings{% endblock %}
{% block subtitle %}Configure application settings and preferences{% endblock %}

{% block content %}
<div class="space-y-6">
  <!-- Quick Actions -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
    <div class="flex flex-wrap gap-3">
      <button onclick="saveAllSettings()" class="inline-flex items-center px-4 py-2 bg-[#DAAC40] text-white font-medium rounded-lg hover:bg-[#b89627] transition-colors duration-200">
        <i data-lucide="save" class="w-4 h-4 mr-2"></i>
        Save All Settings
      </button>
      <button onclick="exportSettings()" class="inline-flex items-center px-4 py-2 bg-gray-100 text-gray-700 font-medium rounded-lg hover:bg-gray-200 transition-colors duration-200">
        <i data-lucide="download" class="w-4 h-4 mr-2"></i>
        Export
      </button>
    </div>
  </div>

  <!-- Settings Categories Navigation -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-200">
    <div class="flex border-b border-gray-200">
      <button onclick="showCategory('general')" class="category-tab active px-6 py-4 text-sm font-medium border-b-2 border-[#DAAC40] text-[#DAAC40] flex items-center">
        <i data-lucide="settings" class="w-4 h-4 mr-2"></i>General
      </button>
      <button onclick="showCategory('security')" class="category-tab px-6 py-4 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700 flex items-center">
        <i data-lucide="shield" class="w-4 h-4 mr-2"></i>Security
      </button>
      <button onclick="showCategory('email')" class="category-tab px-6 py-4 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700 flex items-center">
        <i data-lucide="mail" class="w-4 h-4 mr-2"></i>Email
      </button>
      <button onclick="showCategory('analytics')" class="category-tab px-6 py-4 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700 flex items-center">
        <i data-lucide="bar-chart" class="w-4 h-4 mr-2"></i>Analytics
      </button>
      <button onclick="showCategory('advanced')" class="category-tab px-6 py-4 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700 flex items-center">
        <i data-lucide="sliders" class="w-4 h-4 mr-2"></i>Advanced
      </button>
        </div>
      </div>
          </button>
          <button onclick="showTab('backup')" class="settings-tab" data-tab="backup">
            <i data-lucide="database" class="w-4 h-4 mr-2"></i>
            Backup
          </button>
          <button onclick="showTab('advanced')" class="settings-tab" data-tab="advanced">
            <i data-lucide="code" class="w-4 h-4 mr-2"></i>
            Advanced
          </button>
        </nav>
      </div>
      <!-- Settings Content -->
      <div class="settings-content">
        <!-- General Settings -->
        <div id="general" class="tab-content active">
          <div class="bg-white rounded-xl shadow-sm border border-gray-200 hover:shadow-md transition-shadow duration-200">
            <div class="p-6 border-b border-gray-200">
              <h2 class="text-lg font-semibold text-gray-900 flex items-center">
                <i data-lucide="globe" class="w-5 h-5 mr-2 text-[#DAAC40]"></i>
                General Settings
              </h2>
            </div>
            <div class="p-6 space-y-6">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Site Name</label>
                  <input type="text" name="site_name" value="{{ data.settings.site_name or 'Super SEO Toolkit' }}" 
                         class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#DAAC40] focus:border-transparent">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Admin Email</label>
                  <input type="email" name="admin_email" value="{{ data.settings.admin_email or 'admin@superseo.com' }}" 
                         class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#DAAC40] focus:border-transparent">
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Site Description</label>
                <textarea name="site_description" rows="3" 
                          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#DAAC40] focus:border-transparent">{{ data.settings.site_description or 'Professional SEO tools for better website optimization' }}</textarea>
              </div>
              <div class="flex items-center">
                <input type="checkbox" id="maintenance_mode" name="maintenance_mode" {{ 'checked' if data.settings.maintenance_mode else '' }} 
                       class="rounded border-gray-300 text-[#DAAC40] focus:ring-[#DAAC40]">
                <label for="maintenance_mode" class="ml-2 text-sm text-gray-700">Enable maintenance mode</label>
              </div>
            </div>
          </div>
        </div>

        <!-- SEO Settings -->
        <div id="seo" class="tab-content hidden">
          <div class="bg-white rounded-xl shadow-sm border border-gray-200 hover:shadow-md transition-shadow duration-200">
            <div class="p-6 border-b border-gray-200">
              <h2 class="text-lg font-semibold text-gray-900 flex items-center">
                <i data-lucide="search" class="w-5 h-5 mr-2 text-[#DAAC40]"></i>
                SEO Settings
              </h2>
            </div>
            <div class="p-6 space-y-6">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Default Meta Title</label>
                <input type="text" name="default_meta_title" value="{{ data.settings.default_meta_title or '{page_title} - {site_name}' }}" 
                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#DAAC40] focus:border-transparent">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Default Meta Description</label>
                <textarea name="default_meta_description" rows="3" 
                          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#DAAC40] focus:border-transparent">{{ data.settings.default_meta_description or 'Discover powerful SEO tools and services' }}</textarea>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Google Analytics ID</label>
                  <input type="text" name="google_analytics_id" value="{{ data.settings.google_analytics_id or '' }}" 
                         placeholder="GA-XXXXXXXXX-X" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#DAAC40] focus:border-transparent">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Google Search Console</label>
                  <input type="text" name="google_search_console" value="{{ data.settings.google_search_console or '' }}" 
                         class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#DAAC40] focus:border-transparent">
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Security Settings -->
        <div id="security" class="tab-content hidden">
          <div class="bg-white rounded-xl shadow-sm border border-gray-200 hover:shadow-md transition-shadow duration-200">
            <div class="p-6 border-b border-gray-200">
              <h2 class="text-lg font-semibold text-gray-900 flex items-center">
                <i data-lucide="shield" class="w-5 h-5 mr-2 text-[#DAAC40]"></i>
                Security Settings
              </h2>
            </div>
            <div class="p-6 space-y-6">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Session Timeout (minutes)</label>
                  <input type="number" name="session_timeout" value="{{ data.settings.session_timeout or '30' }}" min="5" max="1440"
                         class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#DAAC40] focus:border-transparent">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Max Login Attempts</label>
                  <input type="number" name="max_login_attempts" value="{{ data.settings.max_login_attempts or '5' }}" min="3" max="10"
                         class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#DAAC40] focus:border-transparent">
                </div>
              </div>
              
              <div class="space-y-4">
                <div class="flex items-center">
                  <input type="checkbox" id="two_factor_auth" name="two_factor_auth" {{ 'checked' if data.settings.two_factor_auth else '' }} 
                         class="rounded border-gray-300 text-[#DAAC40] focus:ring-[#DAAC40]">
                  <label for="two_factor_auth" class="ml-2 text-sm text-gray-700">Require 2FA for admins</label>
                </div>
                <div class="flex items-center">
                  <input type="checkbox" id="https_redirect" name="https_redirect" {{ 'checked' if data.settings.https_redirect else '' }} 
                         class="rounded border-gray-300 text-[#DAAC40] focus:ring-[#DAAC40]">
                  <label for="https_redirect" class="ml-2 text-sm text-gray-700">Force HTTPS connections</label>
                </div>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Content Security Policy</label>
                <textarea name="csp_policy" rows="4" 
                          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#DAAC40] focus:border-transparent">{{ data.settings.csp_policy or "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline';" }}</textarea>
              </div>
            </div>
          </div>
        </div>

        <!-- System Settings -->
        <div id="system" class="tab-content hidden">
          <div class="bg-white rounded-xl shadow-sm border border-gray-200 hover:shadow-md transition-shadow duration-200">
            <div class="p-6 border-b border-gray-200">
              <h2 class="text-lg font-semibold text-gray-900 flex items-center">
                <i data-lucide="server" class="w-5 h-5 mr-2 text-[#DAAC40]"></i>
                System Settings
              </h2>
            </div>
            <div class="p-6 space-y-6">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">API Rate Limit (per minute)</label>
                  <input type="number" name="api_rate_limit" value="{{ data.settings.api_rate_limit or '100' }}" min="10" max="1000"
                         class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#DAAC40] focus:border-transparent">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Backup Frequency</label>
                  <select name="backup_frequency" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#DAAC40] focus:border-transparent">
                    <option value="daily" {{ 'selected' if data.settings.backup_frequency == 'daily' else '' }}>Daily</option>
                    <option value="weekly" {{ 'selected' if data.settings.backup_frequency == 'weekly' else '' }}>Weekly</option>
                    <option value="monthly" {{ 'selected' if data.settings.backup_frequency == 'monthly' else '' }}>Monthly</option>
                  </select>
                </div>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Cache Type</label>
                <select name="cache_type" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#DAAC40] focus:border-transparent">
                  <option value="simple" {{ 'selected' if data.settings.cache_type == 'simple' else '' }}>Simple</option>
                  <option value="redis" {{ 'selected' if data.settings.cache_type == 'redis' else '' }}>Redis</option>
                  <option value="memcached" {{ 'selected' if data.settings.cache_type == 'memcached' else '' }}>Memcached</option>
                </select>
              </div>
              
              <div class="space-y-4">
                <div class="flex items-center">
                  <input type="checkbox" id="auto_backup" name="auto_backup" {{ 'checked' if data.settings.auto_backup else '' }} 
                         class="rounded border-gray-300 text-[#DAAC40] focus:ring-[#DAAC40]">
                  <label for="auto_backup" class="ml-2 text-sm text-gray-700">Enable automatic backups</label>
                </div>
                <div class="flex items-center">
                  <input type="checkbox" id="debug_mode" name="debug_mode" {{ 'checked' if data.settings.debug_mode else '' }} 
                         class="rounded border-gray-300 text-[#DAAC40] focus:ring-[#DAAC40]">
                  <label for="debug_mode" class="ml-2 text-sm text-gray-700">Enable debug mode</label>
                </div>
              </div>
              
              <div class="pt-4 border-t border-gray-200">
                <button type="button" onclick="createBackup()" class="inline-flex items-center px-4 py-2 bg-gray-100 text-gray-700 font-medium rounded-lg hover:bg-gray-200 transition-colors duration-200">
                  <i data-lucide="download" class="w-4 h-4 mr-2"></i>
                  Create Backup Now
                </button>
              </div>
          </div>
        </div>
      </div>

      <!-- Save Button -->
      <div class="mt-8 text-right">
        <button type="submit" class="inline-flex items-center px-6 py-3 bg-[#DAAC40] text-white font-medium rounded-lg hover:bg-[#C49A36] transition-colors duration-200">
          <i data-lucide="save" class="w-4 h-4 mr-2"></i>
          Save Settings
        </button>
      </div>
    </form>
  </div>
</div>

<script>
  // Tab switching functionality
  document.querySelectorAll('.tab-button').forEach(button => {
      button.addEventListener('click', function() {
        const targetTab = this.getAttribute('data-tab');
        
        // Remove active classes
        document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
        
        // Add active classes
        this.classList.add('active');
        document.getElementById(targetTab).classList.remove('hidden');
      });
    });

    // API Functions
    function createBackup() {
      const btn = event.target;
      const originalContent = btn.innerHTML;
      btn.disabled = true;
      btn.innerHTML = '<i data-lucide="loader" class="w-4 h-4 mr-2 animate-spin"></i>Creating...';

      fetch('/admin/api/backup/create', {
        method: 'POST'
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          showToast('Backup created successfully!', 'success');
        } else {
          showToast('Backup failed: ' + data.message, 'error');
        }
      })
      .catch(error => {
        showToast('Error creating backup', 'error');
      })
      .finally(() => {
        btn.disabled = false;
        btn.innerHTML = originalContent;
        lucide.createIcons();
      });
    }

    function showToast(message, type) {
      const toast = document.createElement('div');
      toast.className = `fixed top-4 right-4 z-50 px-4 py-2 rounded-lg text-white ${type === 'success' ? 'bg-[#DAAC40]' : 'bg-red-500'}`;
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.remove();
      }, 3000);
    }

    // Initialize Lucide icons
    lucide.createIcons();
  </script>
{% endblock %}
