{% extends "base.html" %}

{% block title %}SEO Audit Report - {{ report.title or 'SEO Analysis' }}{% endblock %}

{% block extra_css %}
<style>
.report-card {
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    transition: all 0.3s;
    border: none;
    margin-bottom: 25px;
}

.report-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 15px 15px 0 0;
    padding: 30px;
    text-align: center;
}

.score-circle {
    width: 150px;
    height: 150px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 20px;
    font-size: 3rem;
    font-weight: bold;
    color: white;
}

.score-excellent { background: linear-gradient(135deg, #28a745 0%, #20c997 100%); }
.score-good { background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%); }
.score-poor { background: linear-gradient(135deg, #dc3545 0%, #e83f6f 100%); }

.metric-row {
    background: white;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 15px;
    border-left: 4px solid #007bff;
}

.metric-title {
    font-weight: 600;
    color: #495057;
    margin-bottom: 10px;
}

.metric-value {
    font-size: 1.5rem;
    font-weight: bold;
    color: #007bff;
}

.metric-description {
    color: #6c757d;
    font-size: 0.9rem;
    margin-top: 5px;
}

.issue-critical { border-left-color: #dc3545; }
.issue-warning { border-left-color: #ffc107; }
.issue-info { border-left-color: #17a2b8; }

.recommendation {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
}

.page-analysis {
    background: white;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 10px;
}

.print-btn {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    border: none;
    border-radius: 50px;
    padding: 12px 30px;
    color: white;
    font-weight: 600;
}

@media print {
    .no-print { display: none !important; }
    .report-card { box-shadow: none; }
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center py-3 mb-4 border-bottom no-print">
        <h1>
            <i class="fas fa-file-alt text-primary"></i>
            SEO Audit Report
        </h1>
        <div class="btn-toolbar">
            <a href="{{ url_for('seo_bp.seo_history') }}" class="btn btn-outline-primary mr-2">
                <i class="fas fa-arrow-left"></i> Back to History
            </a>
            <button class="btn print-btn mr-2" onclick="window.print()">
                <i class="fas fa-print"></i> Print Report
            </button>
            <button class="btn btn-outline-success" onclick="downloadPDF()">
                <i class="fas fa-download"></i> Download PDF
            </button>
        </div>
    </div>

    <!-- Report Header -->
    <div class="report-card card">
        <div class="report-header">
            {% set score = report.overall_score or 75 %}
            {% if score >= 80 %}
                {% set score_class = 'score-excellent' %}
                {% set score_text = 'Excellent' %}
            {% elif score >= 60 %}
                {% set score_class = 'score-good' %}
                {% set score_text = 'Good' %}
            {% else %}
                {% set score_class = 'score-poor' %}
                {% set score_text = 'Needs Improvement' %}
            {% endif %}
            
            <div class="score-circle {{ score_class }}">
                {{ score }}
            </div>
            <h2>{{ score_text }} SEO Performance</h2>
            <p style="opacity: 0.9; margin: 0;">
                Audit completed on {{ report.date or '2024-01-15 10:30:00' }}<br>
                {{ report.pages_analyzed or 25 }} pages analyzed
            </p>
        </div>
    </div>

    <!-- Executive Summary -->
    <div class="report-card card">
        <div class="card-header">
            <h4><i class="fas fa-chart-pie text-primary"></i> Executive Summary</h4>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-lg-8">
                    <p class="lead">
                        {{ report.summary or 'Your website shows strong SEO fundamentals with several areas for improvement. The overall score of ' + (score|string) + ' indicates good optimization practices, though there are opportunities to enhance search engine visibility and user experience.' }}
                    </p>
                    
                    <h5>Key Findings:</h5>
                    <ul class="list-unstyled">
                        {% if report.key_findings %}
                            {% for finding in report.key_findings %}
                            <li class="mb-2">
                                <i class="fas fa-{{ 'check' if finding.type == 'positive' else 'exclamation-triangle' if finding.type == 'warning' else 'times' }} text-{{ 'success' if finding.type == 'positive' else 'warning' if finding.type == 'warning' else 'danger' }}"></i>
                                {{ finding.text }}
                            </li>
                            {% endfor %}
                        {% else %}
                            <li class="mb-2">
                                <i class="fas fa-check text-success"></i>
                                Strong technical SEO foundation with proper HTML structure
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-exclamation-triangle text-warning"></i>
                                Missing meta descriptions on {{ (report.missing_meta or 5) }} pages
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-exclamation-triangle text-warning"></i>
                                Page load times could be improved (average {{ report.avg_load_time or '2.3' }}s)
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-check text-success"></i>
                                Mobile-friendly design and responsive layout
                            </li>
                        {% endif %}
                    </ul>
                </div>
                <div class="col-lg-4">
                    <div class="metric-row">
                        <div class="metric-title">Technical SEO</div>
                        <div class="metric-value">{{ report.technical_score or 82 }}/100</div>
                        <div class="metric-description">HTML structure, meta tags, site speed</div>
                    </div>
                    <div class="metric-row">
                        <div class="metric-title">Content Quality</div>
                        <div class="metric-value">{{ report.content_score or 78 }}/100</div>
                        <div class="metric-description">Keyword usage, content depth</div>
                    </div>
                    <div class="metric-row">
                        <div class="metric-title">User Experience</div>
                        <div class="metric-value">{{ report.ux_score or 85 }}/100</div>
                        <div class="metric-description">Mobile friendliness, page speed</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Detailed Metrics -->
    <div class="row">
        <div class="col-lg-6">
            <div class="report-card card">
                <div class="card-header">
                    <h5><i class="fas fa-tachometer-alt text-success"></i> Performance Metrics</h5>
                </div>
                <div class="card-body">
                    <div class="metric-row">
                        <div class="metric-title">Page Load Speed</div>
                        <div class="metric-value">{{ report.avg_load_time or '2.3' }}s</div>
                        <div class="metric-description">Average across all analyzed pages</div>
                    </div>
                    <div class="metric-row">
                        <div class="metric-title">Mobile Performance</div>
                        <div class="metric-value">{{ report.mobile_score or 88 }}/100</div>
                        <div class="metric-description">Mobile PageSpeed Insights score</div>
                    </div>
                    <div class="metric-row">
                        <div class="metric-title">Core Web Vitals</div>
                        <div class="metric-value">{{ report.cwv_status or 'Good' }}</div>
                        <div class="metric-description">LCP, FID, CLS performance</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="report-card card">
                <div class="card-header">
                    <h5><i class="fas fa-search text-info"></i> SEO Fundamentals</h5>
                </div>
                <div class="card-body">
                    <div class="metric-row">
                        <div class="metric-title">Meta Tags</div>
                        <div class="metric-value">{{ report.meta_coverage or 85 }}%</div>
                        <div class="metric-description">Pages with complete meta data</div>
                    </div>
                    <div class="metric-row">
                        <div class="metric-title">Heading Structure</div>
                        <div class="metric-value">{{ report.heading_score or 92 }}%</div>
                        <div class="metric-description">Proper H1-H6 tag usage</div>
                    </div>
                    <div class="metric-row">
                        <div class="metric-title">Internal Links</div>
                        <div class="metric-value">{{ report.internal_links or 156 }}</div>
                        <div class="metric-description">Total internal link connections</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Issues Found -->
    <div class="report-card card">
        <div class="card-header">
            <h5><i class="fas fa-exclamation-triangle text-warning"></i> Issues & Recommendations</h5>
        </div>
        <div class="card-body">
            {% if report.issues %}
                {% for issue in report.issues %}
                <div class="metric-row issue-{{ issue.severity or 'warning' }}">
                    <div class="d-flex justify-content-between align-items-start">
                        <div style="flex: 1;">
                            <div class="metric-title">{{ issue.title or 'SEO Issue' }}</div>
                            <div class="metric-description">{{ issue.description or 'Issue description not available' }}</div>
                            {% if issue.affected_pages %}
                                <small class="text-muted">Affects {{ issue.affected_pages|length }} page(s)</small>
                            {% endif %}
                        </div>
                        <div class="text-right">
                            <span class="badge badge-{{ 'danger' if issue.severity == 'critical' else 'warning' if issue.severity == 'warning' else 'info' }}">
                                {{ issue.severity|default('warning')|title }}
                            </span>
                        </div>
                    </div>
                    {% if issue.recommendation %}
                    <div class="recommendation mt-3">
                        <strong>Recommendation:</strong> {{ issue.recommendation }}
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            {% else %}
                <!-- Sample issues when no data exists -->
                <div class="metric-row issue-warning">
                    <div class="d-flex justify-content-between align-items-start">
                        <div style="flex: 1;">
                            <div class="metric-title">Missing Meta Descriptions</div>
                            <div class="metric-description">Several pages are missing meta descriptions, which are important for search result snippets.</div>
                            <small class="text-muted">Affects 5 page(s)</small>
                        </div>
                        <div class="text-right">
                            <span class="badge badge-warning">Warning</span>
                        </div>
                    </div>
                    <div class="recommendation mt-3">
                        <strong>Recommendation:</strong> Add unique, compelling meta descriptions (150-160 characters) to all pages to improve click-through rates from search results.
                    </div>
                </div>

                <div class="metric-row issue-info">
                    <div class="d-flex justify-content-between align-items-start">
                        <div style="flex: 1;">
                            <div class="metric-title">Image Alt Text Optimization</div>
                            <div class="metric-description">Some images lack descriptive alt text for accessibility and SEO.</div>
                            <small class="text-muted">Affects 8 image(s)</small>
                        </div>
                        <div class="text-right">
                            <span class="badge badge-info">Info</span>
                        </div>
                    </div>
                    <div class="recommendation mt-3">
                        <strong>Recommendation:</strong> Add descriptive alt text to all images to improve accessibility and provide context for search engines.
                    </div>
                </div>

                <div class="metric-row issue-critical">
                    <div class="d-flex justify-content-between align-items-start">
                        <div style="flex: 1;">
                            <div class="metric-title">Page Load Speed</div>
                            <div class="metric-description">Several pages have load times exceeding 3 seconds, impacting user experience and search rankings.</div>
                            <small class="text-muted">Affects 3 page(s)</small>
                        </div>
                        <div class="text-right">
                            <span class="badge badge-danger">Critical</span>
                        </div>
                    </div>
                    <div class="recommendation mt-3">
                        <strong>Recommendation:</strong> Optimize images, enable compression, and consider using a CDN to improve page load speeds to under 2 seconds.
                    </div>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Page-by-Page Analysis -->
    <div class="report-card card">
        <div class="card-header">
            <h5><i class="fas fa-file-alt text-primary"></i> Page-by-Page Analysis</h5>
        </div>
        <div class="card-body">
            {% if report.pages %}
                {% for page in report.pages %}
                <div class="page-analysis">
                    <div class="d-flex justify-content-between align-items-start">
                        <div style="flex: 1;">
                            <h6>{{ page.title or 'Untitled Page' }}</h6>
                            <small class="text-muted">{{ page.url or '/sample-page' }}</small>
                            <div class="mt-2">
                                <div class="row">
                                    <div class="col-md-3">
                                        <strong>SEO Score:</strong> {{ page.seo_score or 75 }}/100
                                    </div>
                                    <div class="col-md-3">
                                        <strong>Load Time:</strong> {{ page.load_time or '2.1' }}s
                                    </div>
                                    <div class="col-md-3">
                                        <strong>Word Count:</strong> {{ page.word_count or 850 }}
                                    </div>
                                    <div class="col-md-3">
                                        <strong>Issues:</strong> {{ page.issues_count or 2 }}
                                    </div>
                                </div>
                            </div>
                            {% if page.issues %}
                            <div class="mt-2">
                                <small class="text-muted">Issues: {{ ', '.join(page.issues) }}</small>
                            </div>
                            {% endif %}
                        </div>
                        <div class="text-right">
                            <span class="badge badge-{{ 'success' if (page.seo_score or 75) >= 80 else 'warning' if (page.seo_score or 75) >= 60 else 'danger' }}">
                                {{ 'Good' if (page.seo_score or 75) >= 80 else 'Fair' if (page.seo_score or 75) >= 60 else 'Poor' }}
                            </span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <!-- Sample pages when no data exists -->
                <div class="page-analysis">
                    <div class="d-flex justify-content-between align-items-start">
                        <div style="flex: 1;">
                            <h6>Home Page</h6>
                            <small class="text-muted">/</small>
                            <div class="mt-2">
                                <div class="row">
                                    <div class="col-md-3">
                                        <strong>SEO Score:</strong> 88/100
                                    </div>
                                    <div class="col-md-3">
                                        <strong>Load Time:</strong> 1.8s
                                    </div>
                                    <div class="col-md-3">
                                        <strong>Word Count:</strong> 1,250
                                    </div>
                                    <div class="col-md-3">
                                        <strong>Issues:</strong> 1
                                    </div>
                                </div>
                            </div>
                            <div class="mt-2">
                                <small class="text-muted">Issues: Image alt text missing</small>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="badge badge-success">Good</span>
                        </div>
                    </div>
                </div>

                <div class="page-analysis">
                    <div class="d-flex justify-content-between align-items-start">
                        <div style="flex: 1;">
                            <h6>About Us</h6>
                            <small class="text-muted">/about</small>
                            <div class="mt-2">
                                <div class="row">
                                    <div class="col-md-3">
                                        <strong>SEO Score:</strong> 72/100
                                    </div>
                                    <div class="col-md-3">
                                        <strong>Load Time:</strong> 2.3s
                                    </div>
                                    <div class="col-md-3">
                                        <strong>Word Count:</strong> 680
                                    </div>
                                    <div class="col-md-3">
                                        <strong>Issues:</strong> 3
                                    </div>
                                </div>
                            </div>
                            <div class="mt-2">
                                <small class="text-muted">Issues: Missing meta description, Page load speed, H1 tag missing</small>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="badge badge-warning">Fair</span>
                        </div>
                    </div>
                </div>

                <div class="page-analysis">
                    <div class="d-flex justify-content-between align-items-start">
                        <div style="flex: 1;">
                            <h6>Contact</h6>
                            <small class="text-muted">/contact</small>
                            <div class="mt-2">
                                <div class="row">
                                    <div class="col-md-3">
                                        <strong>SEO Score:</strong> 95/100
                                    </div>
                                    <div class="col-md-3">
                                        <strong>Load Time:</strong> 1.5s
                                    </div>
                                    <div class="col-md-3">
                                        <strong>Word Count:</strong> 420
                                    </div>
                                    <div class="col-md-3">
                                        <strong>Issues:</strong> 0
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="badge badge-success">Good</span>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Action Plan -->
    <div class="report-card card no-page-break">
        <div class="card-header">
            <h5><i class="fas fa-tasks text-success"></i> Recommended Action Plan</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <h6>Priority 1 (Critical)</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2">
                            <i class="fas fa-exclamation-circle text-danger"></i>
                            Fix page load speeds on slow pages
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-exclamation-circle text-danger"></i>
                            Add missing H1 tags to pages
                        </li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h6>Priority 2 (Important)</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2">
                            <i class="fas fa-exclamation-triangle text-warning"></i>
                            Write meta descriptions for all pages
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-exclamation-triangle text-warning"></i>
                            Add alt text to images
                        </li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h6>Priority 3 (Enhancement)</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2">
                            <i class="fas fa-info-circle text-info"></i>
                            Improve internal linking structure
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-info-circle text-info"></i>
                            Add schema markup for rich snippets
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function downloadPDF() {
    const reportId = {{ report.id or 1 }};
    fetch(`/admin/api/seo/report/${reportId}/pdf`)
    .then(response => response.blob())
    .then(blob => {
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `seo-audit-report-${reportId}.pdf`;
        a.click();
        window.URL.revokeObjectURL(url);
    });
}

// Print styles
window.addEventListener('beforeprint', function() {
    document.body.classList.add('printing');
});

window.addEventListener('afterprint', function() {
    document.body.classList.remove('printing');
});
</script>
{% endblock %}
