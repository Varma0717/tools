<!-- Analytics and Tracking -->

<!-- Google Analytics 4 (Replace with your tracking ID) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=GA_TRACKING_ID"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'GA_TRACKING_ID', {
    page_title: '{{ self.title() }}',
    page_location: '{{ request.url }}',
    content_group1: 'SEO Tools',
    content_group2: '{{ tool_name | default("General") }}'
});

// Enhanced ecommerce tracking for tool usage
function trackToolUsage(toolName, action) {
    gtag('event', action, {
        'event_category': 'SEO Tools',
        'event_label': toolName,
        'value': 1
    });
}

// Track tool form submissions
document.addEventListener('DOMContentLoaded', function() {
    const forms = document.querySelectorAll('form[id*="form"]');
    forms.forEach(form => {
        form.addEventListener('submit', function(e) {
            const toolName = '{{ tool_name | default("Unknown Tool") }}';
            trackToolUsage(toolName, 'tool_used');
        });
    });
});
</script>

<!-- Facebook Pixel (Replace with your pixel ID) -->
<script>
!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');

fbq('init', 'FACEBOOK_PIXEL_ID');
fbq('track', 'PageView');
fbq('track', 'ViewContent', {
    content_name: '{{ tool_name | default("SEO Tool") }}',
    content_category: 'SEO Tools'
});
</script>

<!-- Hotjar Tracking (Replace with your site ID) -->
<script>
(function(h,o,t,j,a,r){
    h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
    h._hjSettings={hjid:HOTJAR_SITE_ID,hjsv:6};
    a=o.getElementsByTagName('head')[0];
    r=o.createElement('script');r.async=1;
    r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
    a.appendChild(r);
})(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>

<!-- Custom Event Tracking -->
<script>
// Track scroll depth
let maxScroll = 0;
window.addEventListener('scroll', function() {
    const scrollPercent = Math.round((window.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100);
    if (scrollPercent > maxScroll) {
        maxScroll = scrollPercent;
        if (maxScroll % 25 === 0) { // Track at 25%, 50%, 75%, 100%
            gtag('event', 'scroll', {
                'event_category': 'Engagement',
                'event_label': `${maxScroll}%`,
                'value': maxScroll
            });
        }
    }
});

// Track time on page
let startTime = Date.now();
window.addEventListener('beforeunload', function() {
    const timeOnPage = Math.round((Date.now() - startTime) / 1000);
    gtag('event', 'timing_complete', {
        'name': 'time_on_page',
        'value': timeOnPage,
        'event_category': 'Engagement'
    });
});
</script>

{% block custom_analytics %}{% endblock %}