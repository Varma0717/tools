{% extends "base.html" %}

{% block title %}Content Optimizer - SEO Content Analysis Tool{% endblock %}

{% block meta_description %}Optimize your content for SEO with our comprehensive content analyzer. Check readability, keyword density, structure, and get actionable improvement suggestions.{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="bg-gradient-to-br from-green-900 via-emerald-800 to-teal-900 text-white py-20">
    <div class="container mx-auto px-4">
        <div class="max-w-4xl mx-auto text-center">
            <h1 class="text-4xl md:text-5xl font-bold mb-6">
                Content Optimizer
            </h1>
            <p class="text-xl mb-8 text-green-100">
                Analyze and optimize your content for better SEO performance, readability, and user engagement
            </p>
            
            <!-- Analysis Form -->
            <div class="bg-white/10 backdrop-blur-sm rounded-xl p-8 max-w-4xl mx-auto">
                <form id="content-optimizer-form" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium mb-2">Target Keywords (optional)</label>
                            <input 
                                type="text" 
                                id="target-keywords" 
                                name="target_keywords"
                                placeholder="keyword1, keyword2, keyword3" 
                                class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-green-400 focus:border-transparent"
                            >
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">Content Type</label>
                            <select id="content-type" name="content_type" class="w-full px-3 py-3 rounded-lg bg-white/20 border border-white/30 text-white focus:outline-none focus:ring-2 focus:ring-green-400">
                                <option value="blog">Blog Post</option>
                                <option value="article">Article</option>
                                <option value="product">Product Description</option>
                                <option value="landing">Landing Page</option>
                                <option value="news">News Article</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">Content to Analyze</label>
                        <textarea 
                            id="content-input" 
                            name="content"
                            placeholder="Paste your content here for comprehensive SEO analysis..." 
                            rows="12"
                            class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-green-400 focus:border-transparent resize-vertical"
                            required
                        ></textarea>
                        <div class="flex justify-between text-sm text-green-200 mt-2">
                            <span id="word-count">0 words</span>
                            <span id="char-count">0 characters</span>
                        </div>
                    </div>
                    
                    <!-- Analysis Options -->
                    <div>
                        <label class="block text-sm font-medium mb-2">Analysis Depth</label>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <label class="flex items-center space-x-3 bg-white/10 p-4 rounded-lg cursor-pointer hover:bg-white/20 transition-colors">
                                <input type="radio" name="analysis_type" value="quick" class="text-green-600">
                                <div>
                                    <div class="font-medium">Quick Analysis</div>
                                    <div class="text-sm text-green-200">Basic metrics and readability</div>
                                </div>
                            </label>
                            <label class="flex items-center space-x-3 bg-white/10 p-4 rounded-lg cursor-pointer hover:bg-white/20 transition-colors">
                                <input type="radio" name="analysis_type" value="standard" checked class="text-green-600">
                                <div>
                                    <div class="font-medium">Standard Analysis</div>
                                    <div class="text-sm text-green-200">Comprehensive SEO analysis</div>
                                </div>
                            </label>
                            <label class="flex items-center space-x-3 bg-white/10 p-4 rounded-lg cursor-pointer hover:bg-white/20 transition-colors">
                                <input type="radio" name="analysis_type" value="comprehensive" class="text-green-600">
                                <div>
                                    <div class="font-medium">Comprehensive (Pro)</div>
                                    <div class="text-sm text-green-200">Advanced insights & suggestions</div>
                                </div>
                            </label>
                        </div>
                    </div>
                    
                    <button 
                        type="submit" 
                        class="w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-300 transform hover:scale-105"
                    >
                        <i data-lucide="search" class="w-5 h-5 mr-2 inline"></i>
                        Analyze Content
                    </button>
                </form>
            </div>
        </div>
    </div>
</section>

<!-- Results Section -->
<section id="results-section" class="py-16 bg-gray-50" style="display: none;">
    <div class="container mx-auto px-4">
        <div class="max-w-6xl mx-auto">
            
            <!-- Loading State -->
            <div id="loading-state" class="text-center py-12">
                <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mb-4"></div>
                <p class="text-gray-600">Analyzing your content...</p>
                <p class="text-sm text-gray-500 mt-2">This may take a few moments</p>
            </div>
            
            <!-- Results Content -->
            <div id="results-content" style="display: none;">
                
                <!-- Overall Score -->
                <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                    <div class="text-center">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">Content SEO Score</h2>
                        <div class="flex justify-center items-center space-x-8">
                            <div class="relative">
                                <svg class="w-32 h-32 transform -rotate-90">
                                    <circle cx="64" cy="64" r="56" stroke="currentColor" stroke-width="8" fill="transparent" class="text-gray-200"/>
                                    <circle cx="64" cy="64" r="56" stroke="currentColor" stroke-width="8" fill="transparent" 
                                            class="text-green-600" stroke-linecap="round" 
                                            id="score-circle"
                                            stroke-dasharray="351.86" 
                                            stroke-dashoffset="351.86"/>
                                </svg>
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <span id="overall-score" class="text-3xl font-bold text-gray-800">0</span>
                                </div>
                            </div>
                            <div class="text-left">
                                <div id="score-interpretation" class="text-lg font-semibold mb-2">Calculating...</div>
                                <div id="score-details" class="text-sm text-gray-600"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Analysis Tabs -->
                <div class="bg-white rounded-xl shadow-lg mb-8">
                    <div class="border-b border-gray-200">
                        <nav class="flex space-x-8 px-6" aria-label="Tabs">
                            <button class="tab-button active py-4 px-1 border-b-2 border-green-500 font-medium text-sm text-green-600" data-tab="overview">
                                Content Overview
                            </button>
                            <button class="tab-button py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="keywords">
                                Keyword Analysis
                            </button>
                            <button class="tab-button py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="readability">
                                Readability
                            </button>
                            <button class="tab-button py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="structure">
                                Structure
                            </button>
                            <button class="tab-button py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="suggestions">
                                Suggestions
                            </button>
                            <button class="tab-button py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="advanced">
                                Advanced (Pro)
                            </button>
                        </nav>
                    </div>
                    
                    <!-- Tab Content -->
                    <div class="p-6">
                        <!-- Overview Tab -->
                        <div id="overview-tab" class="tab-content">
                            <h3 class="text-xl font-semibold text-gray-800 mb-4">Content Statistics</h3>
                            <div id="overview-content" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <!-- Content will be populated by JavaScript -->
                            </div>
                        </div>
                        
                        <!-- Keywords Tab -->
                        <div id="keywords-tab" class="tab-content hidden">
                            <h3 class="text-xl font-semibold text-gray-800 mb-4">Keyword Optimization</h3>
                            <div id="keywords-content" class="space-y-6">
                                <!-- Content will be populated by JavaScript -->
                            </div>
                        </div>
                        
                        <!-- Readability Tab -->
                        <div id="readability-tab" class="tab-content hidden">
                            <h3 class="text-xl font-semibold text-gray-800 mb-4">Readability Analysis</h3>
                            <div id="readability-content" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Content will be populated by JavaScript -->
                            </div>
                        </div>
                        
                        <!-- Structure Tab -->
                        <div id="structure-tab" class="tab-content hidden">
                            <h3 class="text-xl font-semibold text-gray-800 mb-4">Content Structure</h3>
                            <div id="structure-content" class="space-y-6">
                                <!-- Content will be populated by JavaScript -->
                            </div>
                        </div>
                        
                        <!-- Suggestions Tab -->
                        <div id="suggestions-tab" class="tab-content hidden">
                            <h3 class="text-xl font-semibold text-gray-800 mb-4">Improvement Suggestions</h3>
                            <div id="suggestions-content" class="space-y-6">
                                <!-- Content will be populated by JavaScript -->
                            </div>
                        </div>
                        
                        <!-- Advanced Tab -->
                        <div id="advanced-tab" class="tab-content hidden">
                            <h3 class="text-xl font-semibold text-gray-800 mb-4">Advanced Analysis</h3>
                            <div id="advanced-content" class="space-y-6">
                                <!-- Content will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Upgrade Notice for Free Users -->
<div id="upgrade-notice" class="fixed bottom-4 right-4 bg-gradient-to-r from-purple-600 to-pink-600 text-white p-4 rounded-lg shadow-lg max-w-sm" style="display: none;">
    <div class="flex items-start space-x-3">
        <i data-lucide="star" class="w-6 h-6 text-yellow-300 flex-shrink-0 mt-0.5"></i>
        <div>
            <h4 class="font-semibold text-sm">Upgrade for Advanced Features</h4>
            <p class="text-xs text-purple-100 mt-1">Get comprehensive analysis, competitor insights, and advanced optimization suggestions.</p>
            <a href="/pricing" class="inline-block mt-2 bg-white/20 hover:bg-white/30 px-3 py-1 rounded text-xs font-medium transition-colors">
                Upgrade Now
            </a>
        </div>
        <button onclick="document.getElementById('upgrade-notice').style.display='none'" class="text-purple-200 hover:text-white">
            <i data-lucide="x" class="w-4 h-4"></i>
        </button>
    </div>
</div>

<style>
.tab-content {
    min-height: 300px;
}

.metric-card {
    transition: transform 0.2s ease-in-out;
}

.metric-card:hover {
    transform: translateY(-2px);
}

.status-indicator {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    display: inline-block;
    margin-right: 8px;
}

.status-good { background-color: #10b981; }
.status-warning { background-color: #f59e0b; }
.status-error { background-color: #ef4444; }
.status-low { background-color: #ef4444; }
.status-optimal { background-color: #10b981; }
.status-overused { background-color: #f59e0b; }
.status-underused { background-color: #ef4444; }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('content-optimizer-form');
    const contentInput = document.getElementById('content-input');
    const wordCount = document.getElementById('word-count');
    const charCount = document.getElementById('char-count');
    const resultsSection = document.getElementById('results-section');
    const loadingState = document.getElementById('loading-state');
    const resultsContent = document.getElementById('results-content');
    
    // Real-time word/character counting
    contentInput.addEventListener('input', function() {
        const text = this.value;
        const words = text.trim() === '' ? 0 : text.trim().split(/\s+/).length;
        const characters = text.length;
        
        wordCount.textContent = `${words} words`;
        charCount.textContent = `${characters} characters`;
    });
    
    // Tab functionality
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabButtons.forEach(button => {
        button.addEventListener('click', () => {
            const tabName = button.getAttribute('data-tab');
            
            // Update button states
            tabButtons.forEach(btn => {
                btn.classList.remove('active', 'border-green-500', 'text-green-600');
                btn.classList.add('border-transparent', 'text-gray-500');
            });
            
            button.classList.add('active', 'border-green-500', 'text-green-600');
            button.classList.remove('border-transparent', 'text-gray-500');
            
            // Update content visibility
            tabContents.forEach(content => {
                content.classList.add('hidden');
            });
            
            document.getElementById(tabName + '-tab').classList.remove('hidden');
        });
    });
    
    form.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const formData = new FormData(form);
        const content = formData.get('content').trim();
        
        if (!content) {
            alert('Please enter content to analyze');
            return;
        }
        
        // Show results section and loading state
        resultsSection.style.display = 'block';
        loadingState.style.display = 'block';
        resultsContent.style.display = 'none';
        
        // Scroll to results
        resultsSection.scrollIntoView({ behavior: 'smooth' });
        
        try {
            const response = await fetch('{{ url_for("content_optimizer.analyze_content") }}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    content: content,
                    target_keywords: formData.get('target_keywords'),
                    analysis_type: formData.get('analysis_type'),
                    content_type: formData.get('content_type')
                })
            });
            
            const data = await response.json();
            
            if (data.success) {
                displayResults(data);
            } else {
                throw new Error(data.error || 'Analysis failed');
            }
            
        } catch (error) {
            console.error('Error:', error);
            showError('Failed to analyze content. Please try again.');
        } finally {
            loadingState.style.display = 'none';
        }
    });
    
    function displayResults(data) {
        resultsContent.style.display = 'block';
        
        // Display overall score
        const score = data.seo_score || 0;
        document.getElementById('overall-score').textContent = score;
        updateScoreCircle(score);
        updateScoreInterpretation(score);
        
        // Populate tab content
        populateOverview(data.content_stats || {});
        populateKeywords(data.keyword_analysis || {});
        populateReadability(data.readability || {});
        populateStructure(data.structure_analysis || {});
        populateSuggestions(data);
        populateAdvanced(data);
        
        // Show upgrade notice for free users
        if (data.user_type === 'free') {
            setTimeout(() => {
                document.getElementById('upgrade-notice').style.display = 'block';
            }, 3000);
        }
    }
    
    function updateScoreCircle(score) {
        const circle = document.getElementById('score-circle');
        const circumference = 2 * Math.PI * 56;
        const offset = circumference - (score / 100) * circumference;
        circle.style.strokeDashoffset = offset;
        
        // Color based on score
        if (score >= 80) {
            circle.classList.remove('text-yellow-500', 'text-red-500');
            circle.classList.add('text-green-500');
        } else if (score >= 60) {
            circle.classList.remove('text-green-500', 'text-red-500');
            circle.classList.add('text-yellow-500');
        } else {
            circle.classList.remove('text-green-500', 'text-yellow-500');
            circle.classList.add('text-red-500');
        }
    }
    
    function updateScoreInterpretation(score) {
        const interpretation = document.getElementById('score-interpretation');
        const details = document.getElementById('score-details');
        
        if (score >= 90) {
            interpretation.textContent = 'Excellent';
            interpretation.className = 'text-lg font-semibold mb-2 text-green-600';
            details.textContent = 'Your content is highly optimized for SEO.';
        } else if (score >= 75) {
            interpretation.textContent = 'Good';
            interpretation.className = 'text-lg font-semibold mb-2 text-green-600';
            details.textContent = 'Your content is well-optimized with room for minor improvements.';
        } else if (score >= 60) {
            interpretation.textContent = 'Needs Improvement';
            interpretation.className = 'text-lg font-semibold mb-2 text-yellow-600';
            details.textContent = 'Several optimization opportunities available.';
        } else {
            interpretation.textContent = 'Poor';
            interpretation.className = 'text-lg font-semibold mb-2 text-red-600';
            details.textContent = 'Significant improvements needed for better SEO performance.';
        }
    }
    
    function createMetricCard(title, value, status, message) {
        const statusClass = `status-${status || 'good'}`;
        
        return `
            <div class="metric-card bg-gray-50 rounded-lg p-4 border border-gray-200">
                <div class="flex items-center justify-between mb-2">
                    <h4 class="font-medium text-gray-700">${title}</h4>
                    <span class="status-indicator ${statusClass}"></span>
                </div>
                <div class="text-lg font-semibold text-gray-900 mb-1">${value}</div>
                <p class="text-sm text-gray-600">${message || ''}</p>
            </div>
        `;
    }
    
    function populateOverview(stats) {
        const content = document.getElementById('overview-content');
        let html = '';
        
        if (stats.word_count !== undefined) {
            html += createMetricCard(
                'Word Count', 
                stats.word_count, 
                stats.word_count >= 300 ? 'good' : 'warning',
                stats.word_count >= 300 ? 'Good content length' : 'Consider expanding content'
            );
        }
        
        if (stats.reading_time_minutes !== undefined) {
            html += createMetricCard(
                'Reading Time', 
                `${stats.reading_time_minutes} min`, 
                'good',
                'Estimated reading time'
            );
        }
        
        if (stats.sentence_count !== undefined) {
            html += createMetricCard(
                'Sentences', 
                stats.sentence_count, 
                'good',
                'Total sentence count'
            );
        }
        
        if (stats.paragraph_count !== undefined) {
            html += createMetricCard(
                'Paragraphs', 
                stats.paragraph_count, 
                stats.paragraph_count >= 3 ? 'good' : 'warning',
                stats.paragraph_count >= 3 ? 'Good structure' : 'Add more paragraphs'
            );
        }
        
        if (stats.average_words_per_sentence !== undefined) {
            html += createMetricCard(
                'Avg Words/Sentence', 
                stats.average_words_per_sentence, 
                stats.average_words_per_sentence <= 20 ? 'good' : 'warning',
                stats.average_words_per_sentence <= 20 ? 'Good sentence length' : 'Consider shorter sentences'
            );
        }
        
        if (stats.character_count !== undefined) {
            html += createMetricCard(
                'Characters', 
                stats.character_count.toLocaleString(), 
                'good',
                'Total character count'
            );
        }
        
        content.innerHTML = html || '<p class="text-gray-600">No content statistics available.</p>';
    }
    
    function populateKeywords(keywordData) {
        const content = document.getElementById('keywords-content');
        
        if (!keywordData.target_keywords || Object.keys(keywordData.target_keywords).length === 0) {
            content.innerHTML = `
                <div class="text-center py-8">
                    <i data-lucide="search" class="w-12 h-12 text-gray-400 mx-auto mb-4"></i>
                    <p class="text-gray-600">No target keywords specified. Add keywords above to see detailed analysis.</p>
                </div>
            `;
            return;
        }
        
        let html = '<div class="space-y-4">';
        
        Object.entries(keywordData.target_keywords).forEach(([keyword, data]) => {
            const statusColor = data.status === 'optimal' ? 'green' : data.status === 'good' ? 'blue' : data.status === 'warning' ? 'yellow' : 'red';
            
            html += `
                <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="font-medium text-gray-900">${keyword}</h4>
                        <span class="px-3 py-1 rounded-full text-sm font-medium bg-${statusColor}-100 text-${statusColor}-800">
                            ${data.status.charAt(0).toUpperCase() + data.status.slice(1)}
                        </span>
                    </div>
                    <div class="grid grid-cols-2 gap-4 mb-3">
                        <div>
                            <span class="text-sm text-gray-600">Density:</span>
                            <span class="font-medium text-gray-900 ml-2">${data.density}%</span>
                        </div>
                        <div>
                            <span class="text-sm text-gray-600">Count:</span>
                            <span class="font-medium text-gray-900 ml-2">${data.count}</span>
                        </div>
                    </div>
                    ${data.recommendations && data.recommendations.length > 0 ? `
                        <div class="mt-3">
                            <h5 class="text-sm font-medium text-gray-700 mb-2">Recommendations:</h5>
                            <ul class="text-sm text-gray-600 space-y-1">
                                ${data.recommendations.map(rec => `<li>• ${rec}</li>`).join('')}
                            </ul>
                        </div>
                    ` : ''}
                </div>
            `;
        });
        
        html += '</div>';
        content.innerHTML = html;
    }
    
    function populateReadability(readabilityData) {
        const content = document.getElementById('readability-content');
        
        let html = '';
        
        if (readabilityData.flesch_score !== undefined) {
            const fleschStatus = readabilityData.flesch_score >= 60 ? 'good' : readabilityData.flesch_score >= 30 ? 'warning' : 'error';
            html += createMetricCard(
                'Flesch Reading Score', 
                readabilityData.flesch_score, 
                fleschStatus,
                readabilityData.reading_difficulty || 'Reading difficulty level'
            );
        }
        
        if (readabilityData.grade_level !== undefined) {
            const gradeStatus = readabilityData.grade_level <= 12 ? 'good' : 'warning';
            html += createMetricCard(
                'Grade Level', 
                readabilityData.grade_level, 
                gradeStatus,
                `Reading grade level`
            );
        }
        
        // Advanced readability metrics for pro users
        if (readabilityData.coleman_liau_index !== undefined) {
            html += createMetricCard(
                'Coleman-Liau Index', 
                readabilityData.coleman_liau_index, 
                'good',
                'Alternative readability measure'
            );
        }
        
        if (readabilityData.automated_readability_index !== undefined) {
            html += createMetricCard(
                'ARI Score', 
                readabilityData.automated_readability_index, 
                'good',
                'Automated Readability Index'
            );
        }
        
        content.innerHTML = html || '<p class="text-gray-600">No readability data available.</p>';
    }
    
    function populateStructure(structureData) {
        const content = document.getElementById('structure-content');
        
        let html = '<div class="space-y-6">';
        
        // Headings analysis
        if (structureData.headings) {
            html += `
                <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                    <h4 class="font-medium text-gray-900 mb-3">Headings Structure</h4>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <span class="text-sm text-gray-600">Heading Count:</span>
                            <span class="font-medium text-gray-900 ml-2">${structureData.heading_count || 0}</span>
                        </div>
                        <div>
                            <span class="text-sm text-gray-600">Structure Score:</span>
                            <span class="font-medium text-gray-900 ml-2">${structureData.structure_score || 0}/100</span>
                        </div>
                    </div>
                    ${structureData.headings.length > 0 ? `
                        <div class="mt-3">
                            <h5 class="text-sm font-medium text-gray-700 mb-2">Found Headings:</h5>
                            <ul class="text-sm text-gray-600 space-y-1 max-h-32 overflow-y-auto">
                                ${structureData.headings.map(heading => `<li>• ${heading}</li>`).join('')}
                            </ul>
                        </div>
                    ` : ''}
                </div>
            `;
        }
        
        // Paragraph analysis
        if (structureData.paragraph_lengths) {
            const avgParagraphLength = structureData.paragraph_lengths.reduce((a, b) => a + b, 0) / structureData.paragraph_lengths.length;
            html += `
                <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                    <h4 class="font-medium text-gray-900 mb-3">Paragraph Analysis</h4>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <span class="text-sm text-gray-600">Avg Words/Paragraph:</span>
                            <span class="font-medium text-gray-900 ml-2">${Math.round(avgParagraphLength)}</span>
                        </div>
                        <div>
                            <span class="text-sm text-gray-600">Paragraph Count:</span>
                            <span class="font-medium text-gray-900 ml-2">${structureData.paragraph_lengths.length}</span>
                        </div>
                    </div>
                </div>
            `;
        }
        
        html += '</div>';
        content.innerHTML = html;
    }
    
    function populateSuggestions(data) {
        const content = document.getElementById('suggestions-content');
        
        // Get suggestions from multiple sources
        const allSuggestions = [];
        
        if (data.advanced_suggestions) {
            allSuggestions.push(...data.advanced_suggestions.map(s => ({ type: 'seo', text: s })));
        }
        
        if (data.content_gaps) {
            allSuggestions.push(...data.content_gaps.map(s => ({ type: 'content', text: s })));
        }
        
        if (data.readability && data.readability.recommendations) {
            allSuggestions.push(...data.readability.recommendations.map(s => ({ type: 'readability', text: s })));
        }
        
        if (allSuggestions.length === 0) {
            content.innerHTML = `
                <div class="text-center py-8">
                    <i data-lucide="check-circle" class="w-12 h-12 text-green-500 mx-auto mb-4"></i>
                    <p class="text-gray-600">Great job! No major improvements needed.</p>
                </div>
            `;
            return;
        }
        
        let html = '<div class="space-y-4">';
        
        allSuggestions.forEach((suggestion, index) => {
            const typeColor = suggestion.type === 'seo' ? 'blue' : suggestion.type === 'content' ? 'green' : 'yellow';
            const typeIcon = suggestion.type === 'seo' ? 'search' : suggestion.type === 'content' ? 'edit' : 'book-open';
            
            html += `
                <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                    <div class="flex items-start space-x-3">
                        <i data-lucide="${typeIcon}" class="w-5 h-5 text-${typeColor}-600 flex-shrink-0 mt-0.5"></i>
                        <div class="flex-1">
                            <div class="flex items-center space-x-2 mb-1">
                                <span class="px-2 py-1 rounded text-xs font-medium bg-${typeColor}-100 text-${typeColor}-800">
                                    ${suggestion.type.toUpperCase()}
                                </span>
                            </div>
                            <p class="text-gray-700">${suggestion.text}</p>
                        </div>
                    </div>
                </div>
            `;
        });
        
        html += '</div>';
        content.innerHTML = html;
    }
    
    function populateAdvanced(data) {
        const content = document.getElementById('advanced-content');
        
        if (data.user_type === 'free') {
            content.innerHTML = `
                <div class="bg-gradient-to-br from-purple-50 to-pink-50 border border-purple-200 rounded-xl p-8 text-center">
                    <i data-lucide="lock" class="w-12 h-12 text-purple-600 mx-auto mb-4"></i>
                    <h4 class="text-xl font-semibold text-purple-800 mb-2">Advanced Content Analysis</h4>
                    <p class="text-purple-600 mb-4">Unlock comprehensive content insights including:</p>
                    <ul class="text-left text-purple-700 space-y-2 mb-6 max-w-md mx-auto">
                        <li>• Semantic analysis and topic modeling</li>
                        <li>• Competitor content insights</li>
                        <li>• Engagement prediction scoring</li>
                        <li>• Advanced readability metrics</li>
                        <li>• Content optimization recommendations</li>
                        <li>• Sentiment analysis</li>
                    </ul>
                    <a href="/pricing" class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white font-semibold rounded-lg hover:from-purple-700 hover:to-pink-700 transition-colors">
                        <i data-lucide="star" class="w-5 h-5 mr-2"></i>
                        Upgrade to Pro
                    </a>
                </div>
            `;
        } else {
            let html = '<div class="space-y-6">';
            
            if (data.semantic_analysis) {
                html += `
                    <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                        <h4 class="font-medium text-gray-900 mb-3">Semantic Analysis</h4>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <span class="text-sm text-gray-600">Unique Words:</span>
                                <span class="font-medium text-gray-900 ml-2">${data.semantic_analysis.unique_words}</span>
                            </div>
                            <div>
                                <span class="text-sm text-gray-600">Lexical Diversity:</span>
                                <span class="font-medium text-gray-900 ml-2">${data.semantic_analysis.lexical_diversity}</span>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            if (data.engagement_prediction) {
                html += `
                    <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                        <h4 class="font-medium text-gray-900 mb-3">Engagement Prediction</h4>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <span class="text-sm text-gray-600">Engagement Score:</span>
                                <span class="font-medium text-gray-900 ml-2">${data.engagement_prediction.engagement_score}/100</span>
                            </div>
                            <div>
                                <span class="text-sm text-gray-600">Prediction:</span>
                                <span class="font-medium text-gray-900 ml-2">${data.engagement_prediction.prediction}</span>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            html += '</div>';
            content.innerHTML = html;
        }
    }
    
    function showError(message) {
        resultsContent.style.display = 'block';
        resultsContent.innerHTML = `
            <div class="bg-red-50 border border-red-200 rounded-xl p-8 text-center">
                <i data-lucide="alert-circle" class="w-12 h-12 text-red-500 mx-auto mb-4"></i>
                <h3 class="text-lg font-semibold text-red-800 mb-2">Analysis Failed</h3>
                <p class="text-red-600">${message}</p>
                <button onclick="location.reload()" class="mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                    Try Again
                </button>
            </div>
        `;
    }
    
    // Initialize Lucide icons
    if (typeof lucide !== 'undefined') {
        lucide.createIcons();
    }
});
</script>
{% endblock %}
