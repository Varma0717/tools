{% extends 'base.html' %}

{% block title %}
  Keyword Density Analyzer - Free SEO Keyword Analysis Tool
{% endblock %}

{% block meta_description %}
  Analyze keyword density and frequency in your content. Optimize keyword usage for better SEO rankings with detailed keyword distribution analysis.
{% endblock %}

{% block content %}
  <div class="min-h-screen bg-gray-50">
    <!-- Tool Hero Section -->
    <section class="bg-gradient-to-br from-slate-900 via-blue-900 to-indigo-900 text-white py-20">
      <div class="max-w-6xl mx-auto px-6">
        <div class="text-center mb-12">
          <div class="w-20 h-20 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center mx-auto mb-6">
            <i data-lucide="search" class="w-10 h-10 text-white"></i>
          </div>
          <div class="flex items-center justify-center mb-4">
            <img src="{{ url_for('static', filename='favicon.png') }}" alt="Super SEO Toolkit" class="w-8 h-8 rounded-lg mr-3" />
            <h1 class="text-3xl md:text-5xl font-bold">Keyword Density Analyzer</h1>
          </div>
          <p class="text-xl text-green-100 mb-8 max-w-3xl mx-auto leading-relaxed">Analyze keyword frequency and optimize your content for better SEO performance</p>

          <!-- Keyword Analyzer Form -->
          <div class="bg-white/10 backdrop-blur-sm rounded-xl p-6 max-w-2xl mx-auto">
            <form id="keywordAnalyzerForm" class="space-y-4">
              <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
              <div class="relative">
                <input
                  type="url"
                  name="url"
                  id="urlInput"
                  placeholder="Enter website URL (e.g., https://example.com)"
                  class="w-full px-4 py-4 bg-white text-gray-900 rounded-lg border-2 border-transparent focus:border-yellow-500 focus:outline-none text-lg"
                  required
                />
                <div class="absolute inset-y-0 right-0 flex items-center pr-4">
                  <i data-lucide="globe" class="w-5 h-5 text-gray-400"></i>
                </div>
              </div>
              <button
                type="submit"
                class="w-full bg-yellow-500 hover:bg-yellow-600 text-yellow-900 px-8 py-4 rounded-lg font-bold text-lg transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
              >
                <span class="analyze-text">
                  <i data-lucide="search" class="w-5 h-5 inline mr-2"></i>
                  Analyze Keywords
                </span>
                <span class="analyze-loader hidden">
                  <i data-lucide="loader-2" class="w-5 h-5 inline mr-2 animate-spin"></i>
                  Analyzing...
                </span>
              </button>
            </form>
          </div>
        </div>
      </div>
    </section>

    <!-- Results Section -->
    <section id="resultsSection" class="py-16 hidden">
      <div class="max-w-6xl mx-auto px-6">
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
          <!-- Results Header -->
          <div class="bg-gradient-to-r from-green-600 to-blue-600 text-white p-6">
            <h2 class="text-2xl font-bold mb-2">Keyword Density Analysis Results</h2>
            <p class="text-green-100">Complete keyword frequency analysis of your website content</p>
          </div>

          <!-- Stats Summary -->
          <div class="p-6 border-b border-gray-200">
            <div class="grid md:grid-cols-4 gap-6">
              <div class="text-center">
                <div class="text-3xl font-bold text-blue-600" id="totalWords">--</div>
                <div class="text-gray-600">Total Words</div>
              </div>
              <div class="text-center">
                <div class="text-3xl font-bold text-green-600" id="uniqueWords">--</div>
                <div class="text-gray-600">Unique Words</div>
              </div>
              <div class="text-center">
                <div class="text-3xl font-bold text-purple-600" id="topKeywordDensity">--</div>
                <div class="text-gray-600">Top Density %</div>
              </div>
              <div class="text-center">
                <div class="text-3xl font-bold text-orange-600" id="phraseCount">--</div>
                <div class="text-gray-600">Key Phrases</div>
              </div>
            </div>
          </div>

          <!-- Results Tabs -->
          <div class="border-b border-gray-200">
            <nav class="flex space-x-8 px-6" aria-label="Tabs">
              <button class="tab-btn border-b-2 border-green-500 text-green-600 py-4 px-1 font-medium text-sm" data-tab="keywords">
                Top Keywords
              </button>
              <button class="tab-btn border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 py-4 px-1 font-medium text-sm" data-tab="phrases">
                Key Phrases
              </button>
              <button class="tab-btn border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 py-4 px-1 font-medium text-sm" data-tab="analysis">
                Analysis
              </button>
              <button class="tab-btn border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 py-4 px-1 font-medium text-sm" data-tab="recommendations">
                Tips
              </button>
            </nav>
          </div>

          <!-- Tab Contents -->
          <div class="p-6">
            <!-- Keywords Tab -->
            <div id="keywordsTab" class="tab-content">
              <div class="space-y-4">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Top Keywords by Density</h3>
                <div class="overflow-x-auto">
                  <table class="min-w-full">
                    <thead class="bg-gray-50">
                      <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rank</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Keyword</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Count</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Density</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                      </tr>
                    </thead>
                    <tbody id="keywordsTable" class="bg-white divide-y divide-gray-200">
                      <!-- Dynamic content -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>

            <!-- Phrases Tab -->
            <div id="phrasesTab" class="tab-content hidden">
              <div class="space-y-4">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Key Phrases (2-word combinations)</h3>
                <div class="overflow-x-auto">
                  <table class="min-w-full">
                    <thead class="bg-gray-50">
                      <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rank</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Phrase</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Count</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Density</th>
                      </tr>
                    </thead>
                    <tbody id="phrasesTable" class="bg-white divide-y divide-gray-200">
                      <!-- Dynamic content -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>

            <!-- Analysis Tab -->
            <div id="analysisTab" class="tab-content hidden">
              <div class="space-y-6">
                <h3 class="text-lg font-semibold text-gray-900">Content Analysis</h3>
                <div class="grid md:grid-cols-2 gap-6">
                  <div class="space-y-4">
                    <h4 class="font-medium text-gray-900">Keyword Distribution</h4>
                    <div id="keywordDistribution" class="space-y-2">
                      <!-- Dynamic content -->
                    </div>
                  </div>
                  <div class="space-y-4">
                    <h4 class="font-medium text-gray-900">SEO Assessment</h4>
                    <div id="seoAssessment" class="space-y-3">
                      <!-- Dynamic content -->
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Recommendations Tab -->
            <div id="recommendationsTab" class="tab-content hidden">
              <div class="space-y-6">
                <h3 class="text-lg font-semibold text-gray-900">SEO Recommendations</h3>
                <div class="grid md:grid-cols-1 gap-4">
                  <div class="bg-blue-50 border-l-4 border-blue-400 p-4">
                    <h4 class="font-medium text-blue-900 mb-2">Keyword Density Best Practices</h4>
                    <ul class="text-blue-800 text-sm space-y-1">
                      <li>• Aim for 1-3% density for primary keywords</li>
                      <li>• Use related keywords and synonyms naturally</li>
                      <li>• Focus on user experience over keyword stuffing</li>
                      <li>• Include keywords in titles, headers, and meta descriptions</li>
                    </ul>
                  </div>
                  <div class="bg-green-50 border-l-4 border-green-400 p-4">
                    <h4 class="font-medium text-green-900 mb-2">Content Optimization Tips</h4>
                    <ul class="text-green-800 text-sm space-y-1">
                      <li>• Write naturally and focus on topic relevance</li>
                      <li>• Use long-tail keywords for better targeting</li>
                      <li>• Optimize for semantic search and intent</li>
                      <li>• Monitor competitor keyword strategies</li>
                    </ul>
                  </div>
                  <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4">
                    <h4 class="font-medium text-yellow-900 mb-2">Technical SEO</h4>
                    <ul class="text-yellow-800 text-sm space-y-1">
                      <li>• Ensure proper HTML structure and headings</li>
                      <li>• Use structured data markup</li>
                      <li>• Optimize page loading speed</li>
                      <li>• Implement mobile-friendly design</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- How It Works -->
    <section class="py-16 bg-white">
      <div class="max-w-4xl mx-auto px-6">
        <div class="text-center mb-12">
          <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">How It Works</h2>
          <p class="text-xl text-gray-600">Advanced keyword analysis in three simple steps</p>
        </div>

        <div class="grid md:grid-cols-3 gap-8">
          <div class="text-center">
            <div class="w-12 h-12 bg-green-600 text-white rounded-full flex items-center justify-center text-xl font-bold mx-auto mb-4">1</div>
            <h3 class="text-xl font-bold text-gray-900 mb-3">Enter Your URL</h3>
            <p class="text-gray-600">Input your website URL for comprehensive content analysis</p>
          </div>

          <div class="text-center">
            <div class="w-12 h-12 bg-blue-600 text-white rounded-full flex items-center justify-center text-xl font-bold mx-auto mb-4">2</div>
            <h3 class="text-xl font-bold text-gray-900 mb-3">Get Analysis</h3>
            <p class="text-gray-600">Our system analyzes keyword frequency and distribution</p>
          </div>

          <div class="text-center">
            <div class="w-12 h-12 bg-purple-600 text-white rounded-full flex items-center justify-center text-xl font-bold mx-auto mb-4">3</div>
            <h3 class="text-xl font-bold text-gray-900 mb-3">Optimize Content</h3>
            <p class="text-gray-600">Apply insights to improve your SEO keyword strategy</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Features -->
    <section class="py-16">
      <div class="max-w-6xl mx-auto px-6">
        <div class="text-center mb-12">
          <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">Key Features</h2>
          <p class="text-xl text-gray-600">Professional keyword analysis tools for SEO success</p>
        </div>

        <div class="grid md:grid-cols-3 gap-8">
          <div class="text-center">
            <div class="w-16 h-16 bg-gradient-to-br from-green-500 to-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-4">
              <i data-lucide="zap" class="w-8 h-8 text-white"></i>
            </div>
            <h3 class="text-xl font-bold text-gray-900 mb-3">Lightning Fast</h3>
            <p class="text-gray-600">Get instant keyword analysis results with our optimized scanning technology</p>
          </div>

          <div class="text-center">
            <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center mx-auto mb-4">
              <i data-lucide="target" class="w-8 h-8 text-white"></i>
            </div>
            <h3 class="text-xl font-bold text-gray-900 mb-3">Accurate Analysis</h3>
            <p class="text-gray-600">Precise keyword density calculations based on SEO best practices</p>
          </div>

          <div class="text-center">
            <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-pink-600 rounded-2xl flex items-center justify-center mx-auto mb-4">
              <i data-lucide="trending-up" class="w-8 h-8 text-white"></i>
            </div>
            <h3 class="text-xl font-bold text-gray-900 mb-3">Actionable Insights</h3>
            <p class="text-gray-600">Clear recommendations to improve your keyword strategy and rankings</p>
          </div>
        </div>
      </div>
    </section>
  </div>

<script>
// HTML escape function to prevent XSS
function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}


// Tab functionality
document.addEventListener('DOMContentLoaded', function() {
    const tabBtns = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            const targetTab = btn.dataset.tab;
            
            // Remove active from all tabs
            tabBtns.forEach(b => {
                b.classList.remove('border-green-500', 'text-green-600');
                b.classList.add('border-transparent', 'text-gray-500');
            });
            
            // Add active to clicked tab
            btn.classList.add('border-green-500', 'text-green-600');
            btn.classList.remove('border-transparent', 'text-gray-500');
            
            // Hide all tab contents
            tabContents.forEach(content => content.classList.add('hidden'));
            
            // Show target tab content
            document.getElementById(targetTab + 'Tab').classList.remove('hidden');
        });
    });
});

// Keyword Analyzer Form Handler
document.getElementById('keywordAnalyzerForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const url = document.getElementById('urlInput').value.trim();
    const submitBtn = this.querySelector('button[type="submit"]');
    const analyzeText = submitBtn.querySelector('.analyze-text');
    const analyzeLoader = submitBtn.querySelector('.analyze-loader');
    const resultsSection = document.getElementById('resultsSection');
    
    if (!url) {
        alert('Please enter a valid URL');
        return;
    }
    
    // Show loading state
    analyzeText.classList.add('hidden');
    analyzeLoader.classList.remove('hidden');
    submitBtn.disabled = true;
    
    // Hide previous results
    resultsSection.classList.add('hidden');
    
    // Make AJAX request
    fetch(window.location.pathname + '/ajax', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.getElementById('csrf_token').value
        },
        body: JSON.stringify({
            url: url
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            displayResults(data.results);
            resultsSection.classList.remove('hidden');
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        } else {
            alert('Error: ' + (data.error || 'Analysis failed'));
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Network error occurred. Please try again.');
    })
    .finally(() => {
        analyzeText.classList.remove('hidden');
        analyzeLoader.classList.add('hidden');
        submitBtn.disabled = false;
    });
});

function displayResults(data) {
    // Update summary stats
    document.getElementById('totalWords').textContent = data.total_words || 0;
    document.getElementById('uniqueWords').textContent = data.unique_words || 0;
    
    const topKeyword = data.top_keywords && data.top_keywords[0];
    document.getElementById('topKeywordDensity').textContent = topKeyword ? topKeyword.density + '%' : '--';
    document.getElementById('phraseCount').textContent = data.top_phrases ? data.top_phrases.length : 0;
    
    // Update tabs
    updateKeywordsTab(data.top_keywords || []);
    updatePhrasesTab(data.top_phrases || []);
    updateAnalysisTab(data);
}

function updateKeywordsTab(keywords) {
    const tbody = document.getElementById('keywordsTable');
    tbody.innerHTML = '';
    
    if (keywords.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" class="px-6 py-4 text-center text-gray-500">No keywords found</td></tr>';
        return;
    }
    
    keywords.forEach((keyword, index) => {
        const row = document.createElement('tr');
        row.className = index % 2 === 0 ? 'bg-white' : 'bg-gray-50';
        
        const status = getKeywordStatus(keyword.density);
        
        row.innerHTML = `
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${escapeHtml(index + 1)}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${escapeHtml(keyword.keyword)}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${escapeHtml(keyword.count)}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${escapeHtml(keyword.density)}%</td>
            <td class="px-6 py-4 whitespace-nowrap">
                <span class="${escapeHtml(getStatusClass(status.type))}">${escapeHtml(status.text)}</span>
            </td>
        `;
        tbody.appendChild(row);
    });
}

function updatePhrasesTab(phrases) {
    const tbody = document.getElementById('phrasesTable');
    tbody.innerHTML = '';
    
    if (phrases.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" class="px-6 py-4 text-center text-gray-500">No key phrases found</td></tr>';
        return;
    }
    
    phrases.forEach((phrase, index) => {
        const row = document.createElement('tr');
        row.className = index % 2 === 0 ? 'bg-white' : 'bg-gray-50';
        
        row.innerHTML = `
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${escapeHtml(index + 1)}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${escapeHtml(phrase.phrase)}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${escapeHtml(phrase.count)}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${escapeHtml(phrase.density)}%</td>
        `;
        tbody.appendChild(row);
    });
}

function updateAnalysisTab(data) {
    const distributionDiv = document.getElementById('keywordDistribution');
    const assessmentDiv = document.getElementById('seoAssessment');
    
    // Keyword Distribution
    distributionDiv.innerHTML = '';
    const keywords = data.top_keywords || [];
    const topKeywords = keywords.slice(0, 5);
    
    topKeywords.forEach((keyword, index) => {
        const barWidth = Math.max(keyword.density * 10, 5); // Scale for visual representation
        const div = document.createElement('div');
        div.className = 'flex items-center';
        div.innerHTML = `
            <div class="w-24 text-sm text-gray-600">${escapeHtml(keyword.keyword)}</div>
            <div class="flex-1 mx-3">
                <div class="bg-gray-200 rounded-full h-2">
                    <div class="bg-green-500 h-2 rounded-full" style="width: ${escapeHtml(Math.min(barWidth, 100))}%"></div>
                </div>
            </div>
            <div class="w-12 text-sm text-gray-900">${escapeHtml(keyword.density)}%</div>
        `;
        distributionDiv.appendChild(div);
    });
    
    // SEO Assessment
    assessmentDiv.innerHTML = '';
    const assessments = generateSEOAssessment(data);
    
    assessments.forEach(assessment => {
        const div = document.createElement('div');
        div.className = `p-3 rounded-lg border-l-4 ${assessment.borderColor} ${assessment.bgColor}`;
        div.innerHTML = `
            <div class="font-medium ${escapeHtml(assessment.textColor)}">${escapeHtml(assessment.title)}</div>
            <div class="text-sm ${escapeHtml(assessment.textColor)} opacity-80">${escapeHtml(assessment.description)}</div>
        `;
        assessmentDiv.appendChild(div);
    });
}

function generateSEOAssessment(data) {
    const assessments = [];
    const keywords = data.top_keywords || [];
    const totalWords = data.total_words || 0;
    
    // Check keyword density
    if (keywords.length > 0) {
        const topDensity = keywords[0].density;
        if (topDensity > 5) {
            assessments.push({
                title: 'Keyword Density Warning',
                description: 'Top keyword density is high. Consider reducing to avoid over-optimization.',
                borderColor: 'border-yellow-400',
                bgColor: 'bg-yellow-50',
                textColor: 'text-yellow-800'
            });
        } else if (topDensity >= 1 && topDensity <= 3) {
            assessments.push({
                title: 'Good Keyword Density',
                description: 'Your top keyword density is within optimal range (1-3%).',
                borderColor: 'border-green-400',
                bgColor: 'bg-green-50',
                textColor: 'text-green-800'
            });
        }
    }
    
    // Check content length
    if (totalWords < 300) {
        assessments.push({
            title: 'Content Length',
            description: 'Consider adding more content. Pages with 300+ words typically perform better.',
            borderColor: 'border-blue-400',
            bgColor: 'bg-blue-50',
            textColor: 'text-blue-800'
        });
    } else {
        assessments.push({
            title: 'Good Content Length',
            description: `Your page has ${totalWords} words, which is good for SEO.`,
            borderColor: 'border-green-400',
            bgColor: 'bg-green-50',
            textColor: 'text-green-800'
        });
    }
    
    // Check keyword variety
    const uniqueWords = data.unique_words || 0;
    if (uniqueWords > 100) {
        assessments.push({
            title: 'Good Keyword Variety',
            description: `${uniqueWords} unique keywords provide good semantic diversity.`,
            borderColor: 'border-green-400',
            bgColor: 'bg-green-50',
            textColor: 'text-green-800'
        });
    }
    
    return assessments;
}

function getKeywordStatus(density) {
    if (density >= 1 && density <= 3) {
        return { type: 'good', text: 'Optimal' };
    } else if (density > 3 && density <= 5) {
        return { type: 'warning', text: 'High' };
    } else if (density > 5) {
        return { type: 'error', text: 'Too High' };
    } else {
        return { type: 'info', text: 'Low' };
    }
}

function getStatusClass(type) {
    const baseClass = 'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium';
    switch (type) {
        case 'good': return `${baseClass} bg-green-100 text-green-800`;
        case 'warning': return `${baseClass} bg-yellow-100 text-yellow-800`;
        case 'error': return `${baseClass} bg-red-100 text-red-800`;
        default: return `${baseClass} bg-gray-100 text-gray-800`;
    }
}

// Initialize Lucide icons
if (typeof lucide !== 'undefined') {
    lucide.createIcons();
}
</script>
{% endblock %}