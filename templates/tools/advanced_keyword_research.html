{% extends 'base.html' %}

{% block title %}
  Advanced Keyword Research Tool - Super SEO Toolkit
{% endblock %}
{% block meta_description %}
  Advanced keyword research tool with comprehensive analysis, competitor insights, search volume data, and content optimization recommendations for SEO success.
{% endblock %}

{% block content %}
  <div class="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50">
    <!-- Hero Section -->
    <section class="bg-gradient-to-br from-blue-600 via-purple-600 to-indigo-800 text-white py-20">
      <div class="max-w-6xl mx-auto px-6 text-center">
        <div class="w-24 h-24 bg-white/20 backdrop-blur-sm rounded-3xl flex items-center justify-center mx-auto mb-8">
          <i data-lucide="search" class="w-12 h-12 text-white"></i>
        </div>

        <div class="flex items-center justify-center mb-6">
          <img src="{{ url_for('static', filename='favicon.png') }}" alt="Super SEO Toolkit" class="w-10 h-10 rounded-xl mr-4" />
          <h1 class="text-4xl md:text-6xl font-bold bg-gradient-to-r from-white to-blue-100 bg-clip-text text-transparent">Advanced Keyword Research</h1>
        </div>

        <p class="text-xl text-blue-100 mb-8 max-w-4xl mx-auto leading-relaxed">Discover high-value keywords with comprehensive analysis, competitor insights, search trends, and content optimization strategies to dominate search rankings.</p>

        <div class="flex flex-wrap items-center justify-center gap-6 text-sm">
          <div class="flex items-center bg-white/10 backdrop-blur-sm rounded-full px-4 py-2">
            <i data-lucide="trending-up" class="w-4 h-4 mr-2"></i>
            <span>Search Volume Analysis</span>
          </div>
          <div class="flex items-center bg-white/10 backdrop-blur-sm rounded-full px-4 py-2">
            <i data-lucide="users" class="w-4 h-4 mr-2"></i>
            <span>Competitor Research</span>
          </div>
          <div class="flex items-center bg-white/10 backdrop-blur-sm rounded-full px-4 py-2">
            <i data-lucide="lightbulb" class="w-4 h-4 mr-2"></i>
            <span>Content Opportunities</span>
          </div>
          <div class="flex items-center bg-white/10 backdrop-blur-sm rounded-full px-4 py-2">
            <i data-lucide="target" class="w-4 h-4 mr-2"></i>
            <span>Intent Analysis</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Tool Interface -->
    <section class="py-16">
      <div class="max-w-6xl mx-auto px-6">
        <!-- Input Form -->
        <div class="bg-white rounded-3xl shadow-xl p-8 mb-8 border border-white/20">
          <div class="max-w-2xl mx-auto">
            <h2 class="text-2xl font-bold text-gray-900 mb-6 text-center">Enter Keyword for Advanced Research</h2>

            <form id="keywordResearchForm" class="space-y-6">
              <input type="hidden" id="csrf_token" value="{{ csrf_token }}" />

              <div>
                <label for="inputKeyword" class="block text-sm font-medium text-gray-700 mb-3">Target Keyword</label>
                <div class="relative">
                  <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                    <i data-lucide="search" class="w-5 h-5 text-gray-400"></i>
                  </div>
                  <input type="text" id="inputKeyword" name="keyword" required placeholder="e.g., digital marketing" class="w-full pl-12 pr-4 py-4 border border-gray-300 rounded-2xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 text-lg" />
                </div>
              </div>

              <div class="grid md:grid-cols-2 gap-4">
                <div>
                  <label for="location" class="block text-sm font-medium text-gray-700 mb-3">Location</label>
                  <select id="location" name="location" class="w-full px-4 py-4 border border-gray-300 rounded-2xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200">
                    <option value="United States">United States</option>
                    <option value="United Kingdom">United Kingdom</option>
                    <option value="Canada">Canada</option>
                    <option value="Australia">Australia</option>
                    <option value="Germany">Germany</option>
                    <option value="France">France</option>
                    <option value="Global">Global</option>
                  </select>
                </div>

                <div>
                  <label for="analysisType" class="block text-sm font-medium text-gray-700 mb-3">Analysis Type</label>
                  <select id="analysisType" name="analysis_type" class="w-full px-4 py-4 border border-gray-300 rounded-2xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200">
                    <option value="comprehensive">Comprehensive Analysis</option>
                    <option value="competitor">Competitor Focus</option>
                    <option value="opportunity">Opportunity Analysis</option>
                    <option value="basic">Basic Research</option>
                  </select>
                </div>
              </div>

              <button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white py-4 px-8 rounded-2xl font-semibold text-lg transition-all duration-200 transform hover:scale-105 shadow-lg hover:shadow-xl flex items-center justify-center">
                <span class="research-text flex items-center">
                  <i data-lucide="play" class="w-5 h-5 mr-2"></i>
                  Start Keyword Research
                </span>
                <div class="research-loader hidden">
                  <div class="flex items-center">
                    <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-3"></div>Analyzing keyword data...
                  </div>
                </div>
              </button>
            </form>
          </div>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="hidden">
          <!-- Keyword Overview -->
          <div class="bg-white rounded-3xl shadow-xl p-8 mb-8 border border-white/20">
            <div class="text-center mb-8">
              <h2 class="text-3xl font-bold text-gray-900 mb-4">Keyword Research Results</h2>
              <div class="flex items-center justify-center space-x-8">
                <div class="relative">
                  <div class="w-32 h-32 rounded-full border-8 border-gray-200 flex items-center justify-center relative">
                    <div id="opportunityCircle" class="absolute inset-0 rounded-full border-8 border-transparent"></div>
                    <div class="text-center">
                      <div id="opportunityScore" class="text-3xl font-bold text-gray-900">--</div>
                      <div class="text-sm text-gray-500">Opportunity</div>
                    </div>
                  </div>
                </div>
                <div class="text-left">
                  <div id="keywordTitle" class="text-4xl font-bold mb-2">--</div>
                  <div id="keywordType" class="text-lg text-gray-600 mb-2">Keyword Type</div>
                  <div id="analysisDate" class="text-sm text-gray-500">--</div>
                </div>
              </div>
            </div>

            <!-- Quick Stats Grid -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
              <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl p-6 text-center">
                <div class="w-12 h-12 bg-blue-500 rounded-xl flex items-center justify-center mx-auto mb-3">
                  <i data-lucide="trending-up" class="w-6 h-6 text-white"></i>
                </div>
                <div id="searchVolume" class="text-2xl font-bold text-blue-700 mb-1">--</div>
                <div class="text-sm text-blue-600">Monthly Searches</div>
              </div>

              <div class="bg-gradient-to-br from-red-50 to-red-100 rounded-2xl p-6 text-center">
                <div class="w-12 h-12 bg-red-500 rounded-xl flex items-center justify-center mx-auto mb-3">
                  <i data-lucide="zap" class="w-6 h-6 text-white"></i>
                </div>
                <div id="difficulty" class="text-2xl font-bold text-red-700 mb-1">--</div>
                <div class="text-sm text-red-600">Keyword Difficulty</div>
              </div>

              <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-2xl p-6 text-center">
                <div class="w-12 h-12 bg-green-500 rounded-xl flex items-center justify-center mx-auto mb-3">
                  <i data-lucide="dollar-sign" class="w-6 h-6 text-white"></i>
                </div>
                <div id="cpcEstimate" class="text-2xl font-bold text-green-700 mb-1">--</div>
                <div class="text-sm text-green-600">CPC Estimate</div>
              </div>

              <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-2xl p-6 text-center">
                <div class="w-12 h-12 bg-purple-500 rounded-xl flex items-center justify-center mx-auto mb-3">
                  <i data-lucide="target" class="w-6 h-6 text-white"></i>
                </div>
                <div id="intent" class="text-2xl font-bold text-purple-700 mb-1">--</div>
                <div class="text-sm text-purple-600">Search Intent</div>
              </div>
            </div>
          </div>

          <!-- Detailed Analysis Tabs -->
          <div class="bg-white rounded-3xl shadow-xl overflow-hidden border border-white/20">
            <!-- Tab Navigation -->
            <div class="border-b border-gray-200">
              <nav class="flex space-x-8 px-8 overflow-x-auto" aria-label="Tabs">
                <button class="tab-button active py-4 px-2 border-b-2 border-blue-500 font-medium text-sm text-blue-600 whitespace-nowrap" data-tab="overview">
                  <i data-lucide="layout-dashboard" class="w-4 h-4 inline mr-2"></i>
                  Overview
                </button>
                <button class="tab-button py-4 px-2 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 whitespace-nowrap" data-tab="suggestions">
                  <i data-lucide="lightbulb" class="w-4 h-4 inline mr-2"></i>
                  Keyword Ideas
                </button>
                <button class="tab-button py-4 px-2 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 whitespace-nowrap" data-tab="competition">
                  <i data-lucide="users" class="w-4 h-4 inline mr-2"></i>
                  Competition
                </button>
                <button class="tab-button py-4 px-2 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 whitespace-nowrap" data-tab="serp">
                  <i data-lucide="search" class="w-4 h-4 inline mr-2"></i>
                  SERP Analysis
                </button>
                <button class="tab-button py-4 px-2 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 whitespace-nowrap" data-tab="content">
                  <i data-lucide="file-text" class="w-4 h-4 inline mr-2"></i>
                  Content Ideas
                </button>
              </nav>
            </div>

            <!-- Tab Content -->
            <div class="p-8">
              <!-- Overview Tab -->
              <div id="overviewTab" class="tab-content">
                <div class="grid md:grid-cols-2 gap-8">
                  <!-- Keyword Metrics -->
                  <div class="space-y-6">
                    <div class="bg-gray-50 rounded-2xl p-6">
                      <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-900 flex items-center">
                          <i data-lucide="bar-chart" class="w-5 h-5 mr-2 text-blue-500"></i>
                          Keyword Metrics
                        </h3>
                      </div>
                      <div id="keywordMetrics" class="space-y-4">
                        <!-- Dynamic metrics content -->
                      </div>
                    </div>

                    <!-- Search Intent Analysis -->
                    <div class="bg-gray-50 rounded-2xl p-6">
                      <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-900 flex items-center">
                          <i data-lucide="target" class="w-5 h-5 mr-2 text-purple-500"></i>
                          Search Intent
                        </h3>
                      </div>
                      <div id="intentAnalysis" class="space-y-3">
                        <!-- Dynamic intent content -->
                      </div>
                    </div>
                  </div>

                  <!-- Competition & Trends -->
                  <div class="space-y-6">
                    <!-- Competition Level -->
                    <div class="bg-gray-50 rounded-2xl p-6">
                      <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-900 flex items-center">
                          <i data-lucide="zap" class="w-5 h-5 mr-2 text-red-500"></i>
                          Competition Analysis
                        </h3>
                      </div>
                      <div id="competitionLevel" class="space-y-3">
                        <!-- Dynamic competition content -->
                      </div>
                    </div>

                    <!-- Seasonality -->
                    <div class="bg-gray-50 rounded-2xl p-6">
                      <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-900 flex items-center">
                          <i data-lucide="calendar" class="w-5 h-5 mr-2 text-orange-500"></i>
                          Seasonality
                        </h3>
                      </div>
                      <div id="seasonalityData" class="space-y-3">
                        <!-- Dynamic seasonality content -->
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Keyword Suggestions Tab -->
              <div id="suggestionsTab" class="tab-content hidden">
                <div class="space-y-6">
                  <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-bold text-gray-900">Related Keywords</h3>
                    <div class="flex items-center space-x-4">
                      <select id="suggestionSort" class="px-4 py-2 border border-gray-300 rounded-lg text-sm">
                        <option value="relevance">Sort by Relevance</option>
                        <option value="volume">Sort by Volume</option>
                        <option value="difficulty">Sort by Difficulty</option>
                      </select>
                    </div>
                  </div>

                  <div id="keywordSuggestions" class="space-y-4">
                    <!-- Dynamic suggestions content -->
                  </div>

                  <!-- Premium Features Notice -->
                  <div id="premiumSuggestionsNotice" class="bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 rounded-2xl p-6 text-center">
                    <div class="w-16 h-16 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center mx-auto mb-4">
                      <i data-lucide="crown" class="w-8 h-8 text-white"></i>
                    </div>
                    <h4 class="text-lg font-semibold text-gray-900 mb-2">Unlock Premium Keyword Research</h4>
                    <p class="text-gray-600 mb-4">Get access to 50+ related keywords, long-tail variations, and semantic keywords with Pro plan.</p>
                    <a href="/pricing" class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl font-semibold hover:from-blue-700 hover:to-purple-700 transition-all duration-200">
                      <i data-lucide="arrow-right" class="w-4 h-4 mr-2"></i>
                      Upgrade to Pro
                    </a>
                  </div>
                </div>
              </div>

              <!-- Competition Tab -->
              <div id="competitionTab" class="tab-content hidden">
                <div class="space-y-6">
                  <h3 class="text-xl font-bold text-gray-900 mb-6">Competitor Analysis</h3>

                  <div id="competitorData" class="space-y-4">
                    <!-- Dynamic competitor content -->
                  </div>

                  <!-- Premium Competition Features -->
                  <div id="premiumCompetitionNotice" class="bg-gradient-to-r from-yellow-50 to-orange-50 border border-yellow-200 rounded-2xl p-6 text-center">
                    <div class="w-16 h-16 bg-gradient-to-r from-yellow-500 to-orange-500 rounded-full flex items-center justify-center mx-auto mb-4">
                      <i data-lucide="users" class="w-8 h-8 text-white"></i>
                    </div>
                    <h4 class="text-lg font-semibold text-gray-900 mb-2">Advanced Competitor Intelligence</h4>
                    <p class="text-gray-600 mb-4">Analyze competitor keywords, gap analysis, and content strategies with Pro features.</p>
                    <a href="/pricing" class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-yellow-600 to-orange-600 text-white rounded-xl font-semibold hover:from-yellow-700 hover:to-orange-700 transition-all duration-200">
                      <i data-lucide="arrow-right" class="w-4 h-4 mr-2"></i>
                      Unlock Pro Features
                    </a>
                  </div>
                </div>
              </div>

              <!-- SERP Analysis Tab -->
              <div id="serpTab" class="tab-content hidden">
                <div class="space-y-6">
                  <h3 class="text-xl font-bold text-gray-900 mb-6">SERP Analysis Results</h3>

                  <div id="serpResults" class="space-y-4">
                    <!-- Dynamic SERP content -->
                  </div>
                </div>
              </div>

              <!-- Content Ideas Tab -->
              <div id="contentTab" class="tab-content hidden">
                <div class="space-y-6">
                  <h3 class="text-xl font-bold text-gray-900 mb-6">Content Optimization Ideas</h3>

                  <div id="contentIdeas" class="space-y-4">
                    <!-- Dynamic content ideas -->
                  </div>

                  <!-- Premium Content Features -->
                  <div id="premiumContentNotice" class="bg-gradient-to-r from-green-50 to-teal-50 border border-green-200 rounded-2xl p-6 text-center">
                    <div class="w-16 h-16 bg-gradient-to-r from-green-500 to-teal-500 rounded-full flex items-center justify-center mx-auto mb-4">
                      <i data-lucide="file-text" class="w-8 h-8 text-white"></i>
                    </div>
                    <h4 class="text-lg font-semibold text-gray-900 mb-2">AI-Powered Content Strategy</h4>
                    <p class="text-gray-600 mb-4">Get detailed content outlines, optimization tips, and semantic keyword integration with Pro.</p>
                    <a href="/pricing" class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-green-600 to-teal-600 text-white rounded-xl font-semibold hover:from-green-700 hover:to-teal-700 transition-all duration-200">
                      <i data-lucide="arrow-right" class="w-4 h-4 mr-2"></i>
                      Get Pro Access
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Tool Description -->
        <div class="bg-white rounded-3xl shadow-xl p-8 mt-8 border border-white/20">
          <div class="max-w-4xl mx-auto">
            <h2 class="text-2xl font-bold text-gray-900 mb-6 text-center">Advanced Keyword Research Features</h2>

            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
              <div class="text-center">
                <div class="w-16 h-16 bg-blue-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                  <i data-lucide="trending-up" class="w-8 h-8 text-blue-600"></i>
                </div>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">Search Volume Analysis</h3>
                <p class="text-gray-600 text-sm">Get accurate monthly search volume estimates and trend data for your target keywords.</p>
              </div>

              <div class="text-center">
                <div class="w-16 h-16 bg-purple-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                  <i data-lucide="zap" class="w-8 h-8 text-purple-600"></i>
                </div>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">Keyword Difficulty</h3>
                <p class="text-gray-600 text-sm">Understand how hard it is to rank for keywords with our comprehensive difficulty scoring.</p>
              </div>

              <div class="text-center">
                <div class="w-16 h-16 bg-green-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                  <i data-lucide="users" class="w-8 h-8 text-green-600"></i>
                </div>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">Competitor Research</h3>
                <p class="text-gray-600 text-sm">Analyze what keywords your competitors are ranking for and find content gaps.</p>
              </div>

              <div class="text-center">
                <div class="w-16 h-16 bg-orange-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                  <i data-lucide="target" class="w-8 h-8 text-orange-600"></i>
                </div>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">Search Intent Analysis</h3>
                <p class="text-gray-600 text-sm">Understand user intent behind searches to create more targeted content strategies.</p>
              </div>

              <div class="text-center">
                <div class="w-16 h-16 bg-red-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                  <i data-lucide="lightbulb" class="w-8 h-8 text-red-600"></i>
                </div>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">Content Ideas</h3>
                <p class="text-gray-600 text-sm">Get AI-powered content suggestions and optimization recommendations for better rankings.</p>
              </div>

              <div class="text-center">
                <div class="w-16 h-16 bg-indigo-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                  <i data-lucide="calendar" class="w-8 h-8 text-indigo-600"></i>
                </div>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">Trend Analysis</h3>
                <p class="text-gray-600 text-sm">Identify seasonal patterns and trending opportunities for your keyword strategy.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- JavaScript -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const form = document.getElementById('keywordResearchForm')
      const resultsSection = document.getElementById('resultsSection')
    
      // Tab functionality
      const tabButtons = document.querySelectorAll('.tab-button')
      const tabContents = document.querySelectorAll('.tab-content')
    
      tabButtons.forEach((button) => {
        button.addEventListener('click', () => {
          const tabName = button.getAttribute('data-tab')
    
          // Update active tab button
          tabButtons.forEach((btn) => {
            btn.classList.remove('active', 'border-blue-500', 'text-blue-600')
            btn.classList.add('border-transparent', 'text-gray-500')
          })
          button.classList.add('active', 'border-blue-500', 'text-blue-600')
          button.classList.remove('border-transparent', 'text-gray-500')
    
          // Show corresponding tab content
          tabContents.forEach((content) => {
            content.classList.add('hidden')
          })
          document.getElementById(tabName + 'Tab').classList.remove('hidden')
        })
      })
    
      form.addEventListener('submit', async function (e) {
        e.preventDefault()
    
        const submitButton = form.querySelector('button[type="submit"]')
        const buttonText = submitButton.querySelector('.research-text')
        const buttonLoader = submitButton.querySelector('.research-loader')
    
        // Show loading state
        buttonText.classList.add('hidden')
        buttonLoader.classList.remove('hidden')
        submitButton.disabled = true
    
        const formData = new FormData(form)
        const data = {
          keyword: formData.get('keyword'),
          location: formData.get('location'),
          analysis_type: formData.get('analysis_type'),
          user_type: 'free' // Will be determined by backend
        }
    
        try {
          const response = await fetch('/tools/advanced-keyword-research/ajax', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'X-CSRFToken': document.getElementById('csrf_token').value
            },
            body: JSON.stringify(data)
          })
    
          const result = await response.json()
    
          if (result.success) {
            displayResults(result)
            resultsSection.classList.remove('hidden')
            resultsSection.scrollIntoView({ behavior: 'smooth' })
          } else {
            alert(result.error || 'Analysis failed. Please try again.')
          }
        } catch (error) {
          console.error('Error:', error)
          alert('Network error. Please check your connection and try again.')
        } finally {
          // Reset button state
          buttonText.classList.remove('hidden')
          buttonLoader.classList.add('hidden')
          submitButton.disabled = false
        }
      })
    
      function displayResults(data) {
        // Update main metrics
        document.getElementById('keywordTitle').textContent = data.keyword || '--'
        document.getElementById('keywordType').textContent = data.keyword_type || 'Unknown'
        document.getElementById('analysisDate').textContent = `Analyzed on ${data.timestamp || '--'}`
    
        // Update opportunity score circle
        const opportunityScore = data.opportunity_score || 50
        updateCircularProgress('opportunityCircle', opportunityScore, getScoreColor(opportunityScore))
        document.getElementById('opportunityScore').textContent = opportunityScore
    
        // Update quick stats
        document.getElementById('searchVolume').textContent = formatNumber(data.search_volume) || '--'
        document.getElementById('difficulty').textContent = data.keyword_difficulty || '--'
        document.getElementById('cpcEstimate').textContent = data.cpc_estimate ? `$${data.cpc_estimate}` : '--'
        document.getElementById('intent').textContent = data.search_intent || '--'
    
        // Update detailed tabs
        updateOverviewTab(data)
        updateSuggestionsTab(data)
        updateCompetitionTab(data)
        updateSerpTab(data)
        updateContentTab(data)
      }
    
      function updateOverviewTab(data) {
        // Keyword Metrics
        const metricsHtml = `
                <div class="flex justify-between items-center py-2">
                    <span class="text-gray-600">Search Volume</span>
                    <span class="font-semibold">${formatNumber(data.search_volume) || 'N/A'}</span>
                </div>
                <div class="flex justify-between items-center py-2">
                    <span class="text-gray-600">Keyword Difficulty</span>
                    <span class="font-semibold text-red-600">${data.keyword_difficulty || 'N/A'}/100</span>
                </div>
                <div class="flex justify-between items-center py-2">
                    <span class="text-gray-600">Competition Level</span>
                    <span class="font-semibold">${data.competition_level || 'N/A'}</span>
                </div>
                <div class="flex justify-between items-center py-2">
                    <span class="text-gray-600">Word Count</span>
                    <span class="font-semibold">${data.word_count || 'N/A'}</span>
                </div>
            `
        document.getElementById('keywordMetrics').innerHTML = metricsHtml
    
        // Intent Analysis
        const intentHtml = `
                <div class="flex justify-between items-center py-2">
                    <span class="text-gray-600">Primary Intent</span>
                    <span class="font-semibold">${data.search_intent || 'N/A'}</span>
                </div>
                <div class="flex justify-between items-center py-2">
                    <span class="text-gray-600">Commercial Score</span>
                    <span class="font-semibold">${data.commercial_intent || 'N/A'}/100</span>
                </div>
                <div class="flex justify-between items-center py-2">
                    <span class="text-gray-600">Brand vs Generic</span>
                    <span class="font-semibold">${data.brand_vs_generic || 'N/A'}</span>
                </div>
            `
        document.getElementById('intentAnalysis').innerHTML = intentHtml
    
        // Competition Level
        const competitionHtml = `
                <div class="flex justify-between items-center py-2">
                    <span class="text-gray-600">Competition</span>
                    <span class="font-semibold">${data.competition_level || 'N/A'}</span>
                </div>
                <div class="flex justify-between items-center py-2">
                    <span class="text-gray-600">CPC Estimate</span>
                    <span class="font-semibold">${data.cpc_estimate ? '$' + data.cpc_estimate : 'N/A'}</span>
                </div>
            `
        document.getElementById('competitionLevel').innerHTML = competitionHtml
    
        // Seasonality
        const seasonalityHtml = `
                <div class="flex justify-between items-center py-2">
                    <span class="text-gray-600">Seasonality Score</span>
                    <span class="font-semibold">${data.seasonality_score || 'N/A'}/100</span>
                </div>
                <div class="flex justify-between items-center py-2">
                    <span class="text-gray-600">Scope</span>
                    <span class="font-semibold">${data.local_vs_global || 'N/A'}</span>
                </div>
            `
        document.getElementById('seasonalityData').innerHTML = seasonalityHtml
      }
    
      function updateSuggestionsTab(data) {
        const suggestions = data.keyword_suggestions || []
        let suggestionsHtml = ''
    
        if (suggestions.length > 0) {
          suggestions.forEach((suggestion, index) => {
            suggestionsHtml += `
                        <div class="bg-gray-50 rounded-xl p-4 flex justify-between items-center">
                            <div class="flex-1">
                                <div class="font-semibold text-gray-900">${suggestion.keyword}</div>
                                <div class="text-sm text-gray-600">Relevance: ${suggestion.relevance_score}%</div>
                            </div>
                            <div class="text-right">
                                <div class="text-sm font-semibold text-blue-600">${formatNumber(suggestion.search_volume)} searches</div>
                                <div class="text-xs text-gray-500">Difficulty: ${suggestion.difficulty}/100</div>
                            </div>
                        </div>
                    `
          })
        } else {
          suggestionsHtml = '<div class="text-center text-gray-500 py-8">No keyword suggestions available.</div>'
        }
    
        document.getElementById('keywordSuggestions').innerHTML = suggestionsHtml
    
        // Show/hide premium notice based on user type
        const premiumNotice = document.getElementById('premiumSuggestionsNotice')
        if (data.user_type === 'free' && suggestions.length < 20) {
          premiumNotice.classList.remove('hidden')
        } else {
          premiumNotice.classList.add('hidden')
        }
      }
    
      function updateCompetitionTab(data) {
        let competitorHtml = ''
    
        if (data.competitors && data.competitors.length > 0) {
          data.competitors.forEach((competitor) => {
            competitorHtml += `
                        <div class="bg-gray-50 rounded-xl p-4">
                            <div class="flex justify-between items-center mb-2">
                                <div class="font-semibold text-gray-900">${competitor.domain}</div>
                                <div class="text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded">Rank #${competitor.rank}</div>
                            </div>
                            <div class="text-sm text-gray-600">Domain Authority: ${competitor.da}</div>
                        </div>
                    `
          })
        } else {
          competitorHtml = '<div class="text-center text-gray-500 py-8">Competitor data will be available with analysis.</div>'
        }
    
        document.getElementById('competitorData').innerHTML = competitorHtml
    
        // Show premium notice for free users
        const premiumNotice = document.getElementById('premiumCompetitionNotice')
        if (data.user_type === 'free') {
          premiumNotice.classList.remove('hidden')
        } else {
          premiumNotice.classList.add('hidden')
        }
      }
    
      function updateSerpTab(data) {
        const serp = data.serp_analysis || {}
        let serpHtml = ''
    
        if (serp.top_results && serp.top_results.length > 0) {
          serp.top_results.forEach((result, index) => {
            serpHtml += `
                        <div class="bg-gray-50 rounded-xl p-4">
                            <div class="flex items-center justify-between mb-2">
                                <div class="font-semibold text-gray-900">#${result.position} - ${result.title}</div>
                                <div class="text-sm text-blue-600">DA: ${result.domain_authority}</div>
                            </div>
                            <div class="text-sm text-gray-600 mb-2">${result.url}</div>
                            <div class="text-sm text-gray-500">${result.meta_description}</div>
                            <div class="flex justify-between text-xs text-gray-500 mt-2">
                                <span>Words: ${formatNumber(result.word_count)}</span>
                                <span>Backlinks: ${formatNumber(result.backlinks)}</span>
                            </div>
                        </div>
                    `
          })
        } else {
          serpHtml = '<div class="text-center text-gray-500 py-8">SERP analysis results will appear here.</div>'
        }
    
        document.getElementById('serpResults').innerHTML = serpHtml
      }
    
      function updateContentTab(data) {
        let contentHtml = ''
    
        if (data.content_optimization) {
          const content = data.content_optimization
          contentHtml = `
                    <div class="bg-gray-50 rounded-xl p-6 mb-4">
                        <h4 class="font-semibold text-gray-900 mb-3">Recommended Content Structure</h4>
                        <div class="text-sm text-gray-600 mb-3">Word Count: ${content.recommended_word_count}</div>
                        <div class="space-y-2">
                            ${content.key_sections
                              .map(
                                (section) => `
                                <div class="flex items-center">
                                    <i data-lucide="check-circle" class="w-4 h-4 text-green-500 mr-2"></i>
                                    <span class="text-sm">${section}</span>
                                </div>
                            `
                              )
                              .join('')}
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 rounded-xl p-6">
                        <h4 class="font-semibold text-gray-900 mb-3">SEO Optimization</h4>
                        <div class="space-y-3">
                            <div>
                                <div class="text-sm font-medium text-gray-700">Title Suggestion:</div>
                                <div class="text-sm text-gray-600">${content.meta_optimization.title_suggestion}</div>
                            </div>
                            <div>
                                <div class="text-sm font-medium text-gray-700">Meta Description:</div>
                                <div class="text-sm text-gray-600">${content.meta_optimization.meta_description}</div>
                            </div>
                        </div>
                    </div>
                `
        } else {
          contentHtml = '<div class="text-center text-gray-500 py-8">Content optimization suggestions will appear here.</div>'
        }
    
        document.getElementById('contentIdeas').innerHTML = contentHtml
    
        // Show premium notice for free users
        const premiumNotice = document.getElementById('premiumContentNotice')
        if (data.user_type === 'free') {
          premiumNotice.classList.remove('hidden')
        } else {
          premiumNotice.classList.add('hidden')
        }
      }
    
      function updateCircularProgress(elementId, percentage, color) {
        const circle = document.getElementById(elementId)
        const circumference = 2 * Math.PI * 60 // radius is approximately 60
        const strokeDasharray = `${(percentage / 100) * circumference} ${circumference}`
    
        circle.style.strokeDasharray = strokeDasharray
        circle.style.stroke = color
        circle.style.transform = 'rotate(-90deg)'
        circle.style.transformOrigin = '50% 50%'
      }
    
      function getScoreColor(score) {
        if (score >= 80) return '#10b981' // green
        if (score >= 60) return '#f59e0b' // yellow
        if (score >= 40) return '#f97316' // orange
        return '#ef4444' // red
      }
    
      function formatNumber(num) {
        if (!num) return '0'
        if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M'
        if (num >= 1000) return (num / 1000).toFixed(1) + 'K'
        return num.toString()
      }
    })
  </script>

  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <script>
    lucide.createIcons()
  </script>
{% endblock %}
