{% extends 'base.html' %}

{% block title %}
  SEO Report: {{ report.domain }} - Comprehensive Analysis
{% endblock %}

{% block content %}
  <div class="min-h-screen bg-gray-50 py-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <!-- Header -->
      <div class="mb-8">
        <div class="flex items-center justify-between">
          <div>
            <h1 class="text-3xl font-bold text-gray-900">SEO Report</h1>
            <p class="text-gray-600 mt-1">{{ report.website_url }}</p>
            <p class="text-sm text-gray-500">Generated on {{ report.created_at.strftime('%B %d, %Y at %I:%M %p') }}</p>
          </div>
          <div class="flex space-x-3">
            <a href="{{ url_for('seo_tools.seo_reports_history') }}" 
               class="text-gray-600 hover:text-gray-800">
              <i data-lucide="arrow-left" class="w-5 h-5"></i>
            </a>
            {% if user_has_pro %}
              <a href="{{ url_for('seo_tools.download_report_pdf', report_id=report.id) }}" 
                 class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                <i data-lucide="download" class="w-4 h-4 inline mr-2"></i>
                Download PDF
              </a>
            {% else %}
              <a href="{{ url_for('main.pricing') }}" 
                 class="bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600 transition-colors">
                <i data-lucide="crown" class="w-4 h-4 inline mr-2"></i>
                Upgrade for PDF
              </a>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Score Overview -->
      <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8">
        <div class="grid grid-cols-1 md:grid-cols-5 gap-6">
          <!-- Overall Score -->
          <div class="text-center">
            <div class="w-20 h-20 mx-auto mb-3 rounded-full bg-{{ report.score_color }}-100 flex items-center justify-center">
              <span class="text-2xl font-bold text-{{ report.score_color }}-600">{{ report.score_grade }}</span>
            </div>
            <h3 class="font-semibold text-gray-900">Overall Score</h3>
            <p class="text-2xl font-bold text-{{ report.score_color }}-600">{{ report.overall_score }}/100</p>
          </div>

          <!-- Technical SEO -->
          {% if audit_data.score_breakdown %}
          <div class="text-center">
            <div class="w-20 h-20 mx-auto mb-3 rounded-full bg-blue-100 flex items-center justify-center">
              <i data-lucide="settings" class="w-8 h-8 text-blue-600"></i>
            </div>
            <h3 class="font-semibold text-gray-900">Technical SEO</h3>
            <p class="text-2xl font-bold text-blue-600">{{ audit_data.score_breakdown.technical }}/100</p>
          </div>

          <!-- Content Quality -->
          <div class="text-center">
            <div class="w-20 h-20 mx-auto mb-3 rounded-full bg-green-100 flex items-center justify-center">
              <i data-lucide="file-text" class="w-8 h-8 text-green-600"></i>
            </div>
            <h3 class="font-semibold text-gray-900">Content</h3>
            <p class="text-2xl font-bold text-green-600">{{ audit_data.score_breakdown.content }}/100</p>
          </div>

          <!-- Performance -->
          <div class="text-center">
            <div class="w-20 h-20 mx-auto mb-3 rounded-full bg-purple-100 flex items-center justify-center">
              <i data-lucide="zap" class="w-8 h-8 text-purple-600"></i>
            </div>
            <h3 class="font-semibold text-gray-900">Performance</h3>
            <p class="text-2xl font-bold text-purple-600">{{ audit_data.score_breakdown.performance }}/100</p>
          </div>

          <!-- On-Page SEO -->
          <div class="text-center">
            <div class="w-20 h-20 mx-auto mb-3 rounded-full bg-yellow-100 flex items-center justify-center">
              <i data-lucide="target" class="w-8 h-8 text-yellow-600"></i>
            </div>
            <h3 class="font-semibold text-gray-900">On-Page</h3>
            <p class="text-2xl font-bold text-yellow-600">{{ audit_data.score_breakdown.onpage or 'N/A' }}</p>
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Tab Navigation -->
      <div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-8">
        <nav class="flex space-x-8 px-6 pt-6" aria-label="Tabs">
          <button onclick="showTab('technical')" id="technical-tab" 
                  class="tab-button active whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">
            <i data-lucide="settings" class="w-4 h-4 inline mr-2"></i>
            Technical SEO
          </button>
          <button onclick="showTab('content')" id="content-tab" 
                  class="tab-button whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">
            <i data-lucide="file-text" class="w-4 h-4 inline mr-2"></i>
            Content Analysis
          </button>
          <button onclick="showTab('performance')" id="performance-tab" 
                  class="tab-button whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">
            <i data-lucide="zap" class="w-4 h-4 inline mr-2"></i>
            Performance
          </button>
          <button onclick="showTab('recommendations')" id="recommendations-tab" 
                  class="tab-button whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">
            <i data-lucide="lightbulb" class="w-4 h-4 inline mr-2"></i>
            Recommendations
          </button>
          <button onclick="showTab('pages')" id="pages-tab" 
                  class="tab-button whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">
            <i data-lucide="list" class="w-4 h-4 inline mr-2"></i>
            Pages Analysis
          </button>
        </nav>

        <!-- Technical SEO Tab -->
        <div id="technical-content" class="tab-content p-6">
          <h2 class="text-2xl font-bold text-gray-900 mb-6">Technical SEO Analysis</h2>
          
          {% if audit_data.technical_seo %}
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- SSL Certificate -->
            {% if audit_data.technical_seo.details.ssl %}
            <div class="bg-gray-50 rounded-lg p-6">
              <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                <i data-lucide="shield" class="w-5 h-5 mr-2 text-green-600"></i>
                SSL Certificate
              </h3>
              <div class="space-y-2">
                <div class="flex justify-between">
                  <span class="text-gray-600">Status:</span>
                  <span class="font-medium {% if audit_data.technical_seo.details.ssl.is_valid %}text-green-600{% else %}text-red-600{% endif %}">
                    {% if audit_data.technical_seo.details.ssl.is_valid %}Valid{% else %}Invalid{% endif %}
                  </span>
                </div>
                {% if audit_data.technical_seo.details.ssl.expires %}
                <div class="flex justify-between">
                  <span class="text-gray-600">Expires:</span>
                  <span class="font-medium">{{ audit_data.technical_seo.details.ssl.expires }}</span>
                </div>
                {% endif %}
              </div>
            </div>
            {% endif %}

            <!-- Page Speed -->
            {% if audit_data.technical_seo.details.page_speed %}
            <div class="bg-gray-50 rounded-lg p-6">
              <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                <i data-lucide="clock" class="w-5 h-5 mr-2 text-blue-600"></i>
                Page Speed
              </h3>
              <div class="space-y-2">
                <div class="flex justify-between">
                  <span class="text-gray-600">Load Time:</span>
                  <span class="font-medium 
                    {% if audit_data.technical_seo.details.page_speed.load_time <= 3 %}text-green-600
                    {% elif audit_data.technical_seo.details.page_speed.load_time <= 5 %}text-yellow-600
                    {% else %}text-red-600{% endif %}">
                    {{ "%.2f"|format(audit_data.technical_seo.details.page_speed.load_time) }}s
                  </span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">TTFB:</span>
                  <span class="font-medium">{{ "%.2f"|format(audit_data.technical_seo.details.page_speed.ttfb) }}s</span>
                </div>
              </div>
            </div>
            {% endif %}

            <!-- Mobile Responsiveness -->
            {% if audit_data.technical_seo.details.mobile %}
            <div class="bg-gray-50 rounded-lg p-6">
              <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                <i data-lucide="smartphone" class="w-5 h-5 mr-2 text-purple-600"></i>
                Mobile Responsiveness
              </h3>
              <div class="space-y-2">
                <div class="flex justify-between">
                  <span class="text-gray-600">Mobile Friendly:</span>
                  <span class="font-medium {% if audit_data.technical_seo.details.mobile.is_responsive %}text-green-600{% else %}text-red-600{% endif %}">
                    {% if audit_data.technical_seo.details.mobile.is_responsive %}Yes{% else %}No{% endif %}
                  </span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Viewport Tag:</span>
                  <span class="font-medium {% if audit_data.technical_seo.details.mobile.has_viewport %}text-green-600{% else %}text-red-600{% endif %}">
                    {% if audit_data.technical_seo.details.mobile.has_viewport %}Present{% else %}Missing{% endif %}
                  </span>
                </div>
              </div>
            </div>
            {% endif %}

            <!-- Core Web Vitals (Premium) -->
            {% if user_has_pro and audit_data.technical_seo.details.core_web_vitals %}
            <div class="bg-gray-50 rounded-lg p-6">
              <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                <i data-lucide="activity" class="w-5 h-5 mr-2 text-indigo-600"></i>
                Core Web Vitals
                <span class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                  Premium
                </span>
              </h3>
              <div class="space-y-3">
                {% for vital, data in audit_data.technical_seo.details.core_web_vitals.items() %}
                {% if vital != 'error' %}
                <div class="flex justify-between items-center">
                  <span class="text-gray-600">{{ vital.upper() }}:</span>
                  <div class="text-right">
                    <span class="font-medium">{{ data.value }}</span>
                    <span class="ml-2 inline-flex items-center px-2 py-1 rounded-full text-xs font-medium
                      {% if data.status == 'good' %}bg-green-100 text-green-800
                      {% elif data.status == 'needs-improvement' %}bg-yellow-100 text-yellow-800
                      {% else %}bg-red-100 text-red-800{% endif %}">
                      {{ data.status.replace('-', ' ').title() }}
                    </span>
                  </div>
                </div>
                {% endif %}
                {% endfor %}
              </div>
            </div>
            {% endif %}
          </div>

          <!-- Technical Issues -->
          {% if audit_data.technical_seo.issues %}
          <div class="mt-8">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Technical Issues Found</h3>
            <div class="space-y-4">
              {% for issue in audit_data.technical_seo.issues %}
              <div class="border-l-4 
                {% if issue.severity == 'critical' %}border-red-500 bg-red-50
                {% elif issue.severity == 'medium' %}border-yellow-500 bg-yellow-50
                {% else %}border-gray-500 bg-gray-50{% endif %} p-4 rounded-r-lg">
                <div class="flex items-start">
                  <div class="flex-shrink-0">
                    <i data-lucide="
                      {% if issue.severity == 'critical' %}alert-circle
                      {% elif issue.severity == 'medium' %}alert-triangle
                      {% else %}info{% endif %}" 
                      class="w-5 h-5 
                      {% if issue.severity == 'critical' %}text-red-600
                      {% elif issue.severity == 'medium' %}text-yellow-600
                      {% else %}text-gray-600{% endif %}"></i>
                  </div>
                  <div class="ml-3 flex-1">
                    <h4 class="text-sm font-medium text-gray-900">{{ issue.type }}</h4>
                    <p class="mt-1 text-sm text-gray-700">{{ issue.issue }}</p>
                    <p class="mt-2 text-sm text-gray-600">
                      <strong>Impact:</strong> {{ issue.impact }}
                    </p>
                    <div class="mt-3 bg-white rounded-md p-3 border">
                      <p class="text-sm text-gray-700">
                        <strong>How to fix:</strong> {{ issue.fix }}
                      </p>
                      <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 mt-2">
                        Priority: {{ issue.priority }}
                      </span>
                    </div>
                  </div>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
          {% endif %}
          {% else %}
          <div class="text-center py-12">
            <i data-lucide="alert-circle" class="w-12 h-12 text-gray-400 mx-auto mb-4"></i>
            <h3 class="text-lg font-medium text-gray-900">Technical analysis not available</h3>
            <p class="text-gray-600">Technical SEO data could not be analyzed for this website.</p>
          </div>
          {% endif %}
        </div>

        <!-- Content Analysis Tab -->
        <div id="content-content" class="tab-content p-6 hidden">
          <h2 class="text-2xl font-bold text-gray-900 mb-6">Content Analysis</h2>
          
          {% if audit_data.content_analysis %}
          <!-- Content Overview -->
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <div class="bg-blue-50 rounded-lg p-6">
              <h3 class="text-lg font-semibold text-blue-900 mb-2">Pages Analyzed</h3>
              <p class="text-3xl font-bold text-blue-600">{{ audit_data.content_analysis.details.titles.pages|length if audit_data.content_analysis.details.titles else 0 }}</p>
            </div>
            <div class="bg-green-50 rounded-lg p-6">
              <h3 class="text-lg font-semibold text-green-900 mb-2">Content Score</h3>
              <p class="text-3xl font-bold text-green-600">{{ audit_data.content_analysis.score }}/100</p>
            </div>
            <div class="bg-orange-50 rounded-lg p-6">
              <h3 class="text-lg font-semibold text-orange-900 mb-2">Issues Found</h3>
              <p class="text-3xl font-bold text-orange-600">{{ audit_data.content_analysis.issues|length }}</p>
            </div>
          </div>

          <!-- Page-by-Page Content Analysis -->
          {% if audit_data.content_analysis.details.titles.pages %}
          <div class="mb-8">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Page-by-Page Content Analysis</h3>
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                  <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Page</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Title</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Meta Description</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">H1</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Words</th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                  {% for page_url, title_data in audit_data.content_analysis.details.titles.pages.items() %}
                  <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                      {{ page_url.replace(audit_data.url, '') or '/' }}
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-900">
                      {% if title_data.exists %}
                        <div class="flex items-center">
                          <span class="{% if title_data.length <= 60 %}text-green-600{% else %}text-red-600{% endif %}">
                            {{ title_data.title[:50] }}{% if title_data.title|length > 50 %}...{% endif %}
                          </span>
                          <span class="ml-2 text-xs text-gray-500">({{ title_data.length }})</span>
                        </div>
                      {% else %}
                        <span class="text-red-600">Missing</span>
                      {% endif %}
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-900">
                      {% set meta_data = audit_data.content_analysis.details.meta_descriptions.pages.get(page_url) %}
                      {% if meta_data and meta_data.exists %}
                        <div class="flex items-center">
                          <span class="{% if meta_data.length <= 160 %}text-green-600{% else %}text-yellow-600{% endif %}">
                            {{ meta_data.description[:30] }}{% if meta_data.description|length > 30 %}...{% endif %}
                          </span>
                          <span class="ml-2 text-xs text-gray-500">({{ meta_data.length }})</span>
                        </div>
                      {% else %}
                        <span class="text-red-600">Missing</span>
                      {% endif %}
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-900">
                      {% set heading_data = audit_data.content_analysis.details.headings.pages.get(page_url) %}
                      {% if heading_data %}
                        <span class="{% if heading_data.h1_count == 1 %}text-green-600{% elif heading_data.h1_count == 0 %}text-red-600{% else %}text-yellow-600{% endif %}">
                          {{ heading_data.h1_count }} H1{% if heading_data.h1_count != 1 %}s{% endif %}
                        </span>
                      {% else %}
                        <span class="text-gray-500">N/A</span>
                      {% endif %}
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-900">
                      {% set content_data = audit_data.content_analysis.details.content_length.pages.get(page_url) %}
                      {% if content_data %}
                        <span class="{% if content_data.word_count >= 300 %}text-green-600{% else %}text-red-600{% endif %}">
                          {{ content_data.word_count }}
                        </span>
                      {% else %}
                        <span class="text-gray-500">N/A</span>
                      {% endif %}
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
          {% endif %}

          <!-- Content Issues -->
          {% if audit_data.content_analysis.issues %}
          <div class="mt-8">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Content Issues</h3>
            <div class="space-y-4">
              {% for issue in audit_data.content_analysis.issues %}
              <div class="border-l-4 
                {% if issue.severity == 'critical' %}border-red-500 bg-red-50
                {% elif issue.severity == 'medium' %}border-yellow-500 bg-yellow-50
                {% else %}border-gray-500 bg-gray-50{% endif %} p-4 rounded-r-lg">
                <div class="flex items-start">
                  <div class="flex-shrink-0">
                    <i data-lucide="
                      {% if issue.severity == 'critical' %}alert-circle
                      {% elif issue.severity == 'medium' %}alert-triangle
                      {% else %}info{% endif %}" 
                      class="w-5 h-5 
                      {% if issue.severity == 'critical' %}text-red-600
                      {% elif issue.severity == 'medium' %}text-yellow-600
                      {% else %}text-gray-600{% endif %}"></i>
                  </div>
                  <div class="ml-3 flex-1">
                    <h4 class="text-sm font-medium text-gray-900">{{ issue.type }}</h4>
                    <p class="mt-1 text-sm text-gray-700">{{ issue.issue }}</p>
                    {% if issue.page %}
                    <p class="mt-1 text-xs text-gray-500">Page: {{ issue.page.replace(audit_data.url, '') or '/' }}</p>
                    {% endif %}
                    <p class="mt-2 text-sm text-gray-600">
                      <strong>Impact:</strong> {{ issue.impact }}
                    </p>
                    <div class="mt-3 bg-white rounded-md p-3 border">
                      <p class="text-sm text-gray-700">
                        <strong>How to fix:</strong> {{ issue.fix }}
                      </p>
                      <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 mt-2">
                        Priority: {{ issue.priority }}
                      </span>
                    </div>
                  </div>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
          {% endif %}
          {% else %}
          <div class="text-center py-12">
            <i data-lucide="file-text" class="w-12 h-12 text-gray-400 mx-auto mb-4"></i>
            <h3 class="text-lg font-medium text-gray-900">Content analysis not available</h3>
            <p class="text-gray-600">Content analysis data could not be generated for this website.</p>
          </div>
          {% endif %}
        </div>

        <!-- Performance Tab -->
        <div id="performance-content" class="tab-content p-6 hidden">
          <h2 class="text-2xl font-bold text-gray-900 mb-6">Performance Analysis</h2>
          
          {% if audit_data.performance %}
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- Performance Score -->
            <div class="bg-purple-50 rounded-lg p-6">
              <h3 class="text-lg font-semibold text-purple-900 mb-4">Performance Score</h3>
              <div class="text-center">
                <div class="text-4xl font-bold text-purple-600 mb-2">{{ audit_data.performance.score }}/100</div>
                <div class="text-sm text-purple-700">
                  {% if audit_data.performance.score >= 90 %}Excellent
                  {% elif audit_data.performance.score >= 75 %}Good
                  {% elif audit_data.performance.score >= 50 %}Needs Improvement
                  {% else %}Poor{% endif %}
                </div>
              </div>
            </div>

            <!-- Load Time Breakdown -->
            {% if audit_data.performance.details.speed %}
            <div class="bg-blue-50 rounded-lg p-6">
              <h3 class="text-lg font-semibold text-blue-900 mb-4">Load Time Analysis</h3>
              <div class="space-y-3">
                <div class="flex justify-between">
                  <span class="text-blue-700">Load Time:</span>
                  <span class="font-medium text-blue-900">{{ "%.2f"|format(audit_data.performance.details.speed.load_time) }}s</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-blue-700">TTFB:</span>
                  <span class="font-medium text-blue-900">{{ "%.2f"|format(audit_data.performance.details.speed.ttfb) }}s</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-blue-700">Content Size:</span>
                  <span class="font-medium text-blue-900">{{ "%.1f"|format(audit_data.performance.details.speed.content_size / 1024) }} KB</span>
                </div>
              </div>
            </div>
            {% endif %}
          </div>

          <!-- Resource Analysis -->
          {% if audit_data.performance.details.resources %}
          <div class="mb-8">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Resource Analysis</h3>
            <div class="bg-gray-50 rounded-lg p-6">
              <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="text-center">
                  <div class="text-2xl font-bold text-gray-900">{{ "%.1f"|format(audit_data.performance.details.resources.total_size_mb) }}MB</div>
                  <div class="text-sm text-gray-600">Total Page Size</div>
                </div>
                <div class="text-center">
                  <div class="text-2xl font-bold text-gray-900">{{ audit_data.performance.details.resources.css_files }}</div>
                  <div class="text-sm text-gray-600">CSS Files</div>
                </div>
                <div class="text-center">
                  <div class="text-2xl font-bold text-gray-900">{{ audit_data.performance.details.resources.js_files }}</div>
                  <div class="text-sm text-gray-600">JavaScript Files</div>
                </div>
              </div>
            </div>
          </div>
          {% endif %}

          <!-- Performance Issues -->
          {% if audit_data.performance.issues %}
          <div class="mt-8">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Performance Issues</h3>
            <div class="space-y-4">
              {% for issue in audit_data.performance.issues %}
              <div class="border-l-4 
                {% if issue.severity == 'critical' %}border-red-500 bg-red-50
                {% elif issue.severity == 'medium' %}border-yellow-500 bg-yellow-50
                {% else %}border-gray-500 bg-gray-50{% endif %} p-4 rounded-r-lg">
                <div class="flex items-start">
                  <div class="flex-shrink-0">
                    <i data-lucide="zap" class="w-5 h-5 
                      {% if issue.severity == 'critical' %}text-red-600
                      {% elif issue.severity == 'medium' %}text-yellow-600
                      {% else %}text-gray-600{% endif %}"></i>
                  </div>
                  <div class="ml-3 flex-1">
                    <h4 class="text-sm font-medium text-gray-900">{{ issue.type }}</h4>
                    <p class="mt-1 text-sm text-gray-700">{{ issue.issue }}</p>
                    <p class="mt-2 text-sm text-gray-600">
                      <strong>Impact:</strong> {{ issue.impact }}
                    </p>
                    <div class="mt-3 bg-white rounded-md p-3 border">
                      <p class="text-sm text-gray-700">
                        <strong>How to fix:</strong> {{ issue.fix }}
                      </p>
                      <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 mt-2">
                        Priority: {{ issue.priority }}
                      </span>
                    </div>
                  </div>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
          {% endif %}
          {% else %}
          <div class="text-center py-12">
            <i data-lucide="zap" class="w-12 h-12 text-gray-400 mx-auto mb-4"></i>
            <h3 class="text-lg font-medium text-gray-900">Performance analysis not available</h3>
            <p class="text-gray-600">Performance data could not be analyzed for this website.</p>
          </div>
          {% endif %}
        </div>

        <!-- Recommendations Tab -->
        <div id="recommendations-content" class="tab-content p-6 hidden">
          <h2 class="text-2xl font-bold text-gray-900 mb-6">Actionable Recommendations</h2>
          
          {% if audit_data.recommendations %}
          <!-- Critical Issues -->
          {% if audit_data.recommendations.critical %}
          <div class="mb-8">
            <h3 class="text-lg font-semibold text-red-600 mb-4 flex items-center">
              <i data-lucide="alert-circle" class="w-5 h-5 mr-2"></i>
              Critical Issues ({{ audit_data.recommendations.critical|length }})
            </h3>
            <div class="space-y-4">
              {% for rec in audit_data.recommendations.critical %}
              <div class="bg-red-50 border border-red-200 rounded-lg p-6">
                <div class="flex items-start justify-between">
                  <div class="flex-1">
                    <h4 class="text-lg font-medium text-red-900">{{ rec.title }}</h4>
                    <p class="mt-2 text-red-700">{{ rec.impact }}</p>
                    <div class="mt-4 bg-white rounded-md p-4 border border-red-200">
                      <p class="text-sm text-gray-900">
                        <strong>Solution:</strong> {{ rec.solution }}
                      </p>
                    </div>
                    <div class="mt-3 flex items-center space-x-4">
                      <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                        {{ rec.priority }} Priority
                      </span>
                      <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                        Effort: {{ rec.estimated_effort }}
                      </span>
                      <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                        Impact: {{ rec.expected_impact }}
                      </span>
                    </div>
                  </div>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
          {% endif %}

          <!-- High Impact Recommendations -->
          {% if audit_data.recommendations.high_impact %}
          <div class="mb-8">
            <h3 class="text-lg font-semibold text-orange-600 mb-4 flex items-center">
              <i data-lucide="trending-up" class="w-5 h-5 mr-2"></i>
              High Impact Opportunities ({{ audit_data.recommendations.high_impact|length }})
            </h3>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              {% for rec in audit_data.recommendations.high_impact %}
              <div class="bg-orange-50 border border-orange-200 rounded-lg p-6">
                <h4 class="text-lg font-medium text-orange-900 mb-2">{{ rec.title }}</h4>
                <p class="text-orange-700 text-sm mb-3">{{ rec.impact }}</p>
                <div class="bg-white rounded-md p-3 border border-orange-200 mb-3">
                  <p class="text-sm text-gray-900">{{ rec.solution }}</p>
                </div>
                <div class="flex items-center space-x-2">
                  <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800">
                    {{ rec.priority }}
                  </span>
                  <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                    {{ rec.estimated_effort }}
                  </span>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
          {% endif %}

          <!-- Medium Impact Recommendations -->
          {% if audit_data.recommendations.medium_impact %}
          <div class="mb-8">
            <h3 class="text-lg font-semibold text-yellow-600 mb-4 flex items-center">
              <i data-lucide="lightbulb" class="w-5 h-5 mr-2"></i>
              Medium Impact Improvements ({{ audit_data.recommendations.medium_impact|length }})
            </h3>
            <div class="space-y-3">
              {% for rec in audit_data.recommendations.medium_impact %}
              <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                <div class="flex items-start justify-between">
                  <div class="flex-1">
                    <h4 class="font-medium text-yellow-900">{{ rec.title }}</h4>
                    <p class="text-sm text-yellow-700 mt-1">{{ rec.solution }}</p>
                  </div>
                  <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 ml-3">
                    {{ rec.priority }}
                  </span>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
          {% endif %}
          {% else %}
          <div class="text-center py-12">
            <i data-lucide="lightbulb" class="w-12 h-12 text-gray-400 mx-auto mb-4"></i>
            <h3 class="text-lg font-medium text-gray-900">No recommendations available</h3>
            <p class="text-gray-600">Unable to generate specific recommendations for this website.</p>
          </div>
          {% endif %}
        </div>

        <!-- Pages Analysis Tab -->
        <div id="pages-content" class="tab-content p-6 hidden">
          <h2 class="text-2xl font-bold text-gray-900 mb-6">Individual Pages Analysis</h2>
          
          {% if audit_data.pages_analysis and audit_data.pages_analysis.pages %}
          <!-- Summary Stats -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="bg-blue-50 rounded-lg p-6">
              <h3 class="text-lg font-semibold text-blue-900 mb-2">Total Pages</h3>
              <p class="text-3xl font-bold text-blue-600">{{ audit_data.pages_analysis.total_pages }}</p>
            </div>
            <div class="bg-red-50 rounded-lg p-6">
              <h3 class="text-lg font-semibold text-red-900 mb-2">Pages with Issues</h3>
              <p class="text-3xl font-bold text-red-600">{{ audit_data.pages_analysis.summary.pages_with_issues }}</p>
            </div>
            <div class="bg-green-50 rounded-lg p-6">
              <h3 class="text-lg font-semibold text-green-900 mb-2">Avg. Word Count</h3>
              <p class="text-3xl font-bold text-green-600">{{ "%.0f"|format(audit_data.pages_analysis.summary.average_word_count) }}</p>
            </div>
          </div>

          <!-- Individual Pages Table -->
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Page</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Title</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Meta Desc</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">H1</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Words</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Load Time</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Issues</th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200">
                {% for page in audit_data.pages_analysis.pages %}
                <tr class="{% if page.issues %}bg-red-50{% endif %}">
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                    {{ page.url.replace(audit_data.url, '') or '/' }}
                  </td>
                  <td class="px-6 py-4 text-sm text-gray-900">
                    {% if page.title != 'Missing' %}
                      <div class="{% if page.title_length <= 60 %}text-green-600{% else %}text-red-600{% endif %}">
                        {{ page.title[:40] }}{% if page.title|length > 40 %}...{% endif %}
                        <span class="text-xs text-gray-500">({{ page.title_length }})</span>
                      </div>
                    {% else %}
                      <span class="text-red-600">Missing</span>
                    {% endif %}
                  </td>
                  <td class="px-6 py-4 text-sm text-gray-900">
                    {% if page.meta_description != 'Missing' %}
                      <div class="{% if page.meta_desc_length <= 160 %}text-green-600{% else %}text-yellow-600{% endif %}">
                        {{ page.meta_description[:30] }}{% if page.meta_description|length > 30 %}...{% endif %}
                        <span class="text-xs text-gray-500">({{ page.meta_desc_length }})</span>
                      </div>
                    {% else %}
                      <span class="text-red-600">Missing</span>
                    {% endif %}
                  </td>
                  <td class="px-6 py-4 text-sm text-gray-900">
                    <span class="{% if page.h1_count == 1 %}text-green-600{% elif page.h1_count == 0 %}text-red-600{% else %}text-yellow-600{% endif %}">
                      {{ page.h1_count }}
                    </span>
                  </td>
                  <td class="px-6 py-4 text-sm text-gray-900">
                    <span class="{% if page.word_count >= 300 %}text-green-600{% else %}text-red-600{% endif %}">
                      {{ page.word_count }}
                    </span>
                  </td>
                  <td class="px-6 py-4 text-sm text-gray-900">
                    <span class="{% if page.load_time <= 3 %}text-green-600{% elif page.load_time <= 5 %}text-yellow-600{% else %}text-red-600{% endif %}">
                      {{ "%.2f"|format(page.load_time) }}s
                    </span>
                  </td>
                  <td class="px-6 py-4 text-sm text-gray-900">
                    {% if page.issues %}
                      <div class="space-y-1">
                        {% for issue in page.issues %}
                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">
                          {{ issue }}
                        </span>
                        {% endfor %}
                      </div>
                    {% else %}
                      <span class="text-green-600">âœ“ No issues</span>
                    {% endif %}
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <div class="text-center py-12">
            <i data-lucide="list" class="w-12 h-12 text-gray-400 mx-auto mb-4"></i>
            <h3 class="text-lg font-medium text-gray-900">No pages analyzed</h3>
            <p class="text-gray-600">Individual page analysis data is not available.</p>
          </div>
          {% endif %}
        </div>
      </div>

      {% if not user_has_pro %}
      <!-- Upgrade CTA -->
      <div class="bg-gradient-to-r from-purple-600 to-blue-600 rounded-lg shadow-lg p-8 text-white">
        <div class="flex items-center justify-between">
          <div>
            <h3 class="text-2xl font-bold mb-2">Unlock Premium SEO Analysis</h3>
            <p class="text-purple-100 mb-4">Get advanced insights, competitor analysis, Core Web Vitals, and unlimited reports.</p>
            <ul class="space-y-2 text-sm">
              <li class="flex items-center"><i data-lucide="check" class="w-4 h-4 mr-2"></i>Unlimited SEO audits</li>
              <li class="flex items-center"><i data-lucide="check" class="w-4 h-4 mr-2"></i>Advanced technical analysis (200+ checks)</li>
              <li class="flex items-center"><i data-lucide="check" class="w-4 h-4 mr-2"></i>Core Web Vitals monitoring</li>
              <li class="flex items-center"><i data-lucide="check" class="w-4 h-4 mr-2"></i>White-label PDF reports</li>
            </ul>
          </div>
          <div class="text-center">
            <div class="text-4xl font-bold mb-2">$29</div>
            <div class="text-purple-200 text-sm mb-4">per month</div>
            <a href="{{ url_for('main.pricing') }}" 
               class="bg-white text-purple-600 hover:bg-gray-100 px-8 py-3 rounded-lg font-semibold transition-colors inline-block">
              Upgrade Now
            </a>
          </div>
        </div>
      </div>
      {% endif %}
    </div>
  </div>

  <script>
    // Tab functionality
    function showTab(tabName) {
      // Hide all tab contents
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.add('hidden');
      });
      
      // Remove active class from all tabs
      document.querySelectorAll('.tab-button').forEach(button => {
        button.classList.remove('active', 'border-blue-500', 'text-blue-600');
        button.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
      });
      
      // Show selected tab content
      document.getElementById(tabName + '-content').classList.remove('hidden');
      
      // Add active class to selected tab
      const activeTab = document.getElementById(tabName + '-tab');
      activeTab.classList.add('active', 'border-blue-500', 'text-blue-600');
      activeTab.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
    }

    // Initialize first tab as active
    document.addEventListener('DOMContentLoaded', function() {
      showTab('technical');
      
      // Initialize Lucide icons
      if (typeof lucide !== 'undefined') {
        lucide.createIcons();
      }
    });
  </script>

  <style>
    .tab-button {
      border-bottom: 2px solid transparent;
      transition: all 0.2s ease-in-out;
    }
    
    .tab-button.active {
      border-bottom-color: #3b82f6;
      color: #3b82f6;
    }
    
    .tab-button:not(.active) {
      color: #6b7280;
      border-bottom-color: transparent;
    }
    
    .tab-button:not(.active):hover {
      color: #374151;
      border-bottom-color: #d1d5db;
    }
  </style>
{% endblock %}
