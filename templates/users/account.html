{% extends 'base.html' %}
{% block title %}My Account{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto py-14 px-4 sm:px-6 lg:px-8" 
     x-data="accountTabs()" 
     x-init="loadSection('overview')">

    <div class="flex flex-col md:flex-row gap-8">
        <!-- Sidebar Navigation -->
        <aside class="md:w-1/4 w-full bg-white/80 backdrop-blur-xl rounded-2xl shadow-2xl overflow-hidden border border-gray-100">
            <div class="py-8 px-2 flex flex-col items-center border-b border-gray-100 bg-gradient-to-b from-[#FAF7EC] via-white to-[#f5f5f5]">
                <div class="bg-[#DAAC40]/10 p-3 rounded-full mb-2">
                    <i data-lucide="user-round" class="lucide w-10 h-10 text-[#DAAC40]"></i>
                </div>
                <div class="font-semibold text-lg text-gray-900 mb-1">
                    {{ current_user.username }}
                </div>
                <div class="text-xs text-gray-500">{{ current_user.email }}</div>
            </div>
            <ul class="py-2 space-y-1">
                <template x-for="item in tabs" :key="item.key">
                    <li>
                        <a href="#" 
                           @click.prevent="item.key === 'logout' ? logout() : loadSection(item.key)" 
                           :class="section === item.key ? 'bg-[#DAAC40]/10 text-[#DAAC40] font-bold shadow-sm' : 'text-gray-800 hover:bg-gray-50 hover:text-[#DAAC40]'}"
                           class="flex items-center gap-2 px-6 py-3 rounded-xl transition-all duration-200 text-base">
                            <i :data-lucide="item.icon" class="lucide w-5 h-5"></i>
                            <span x-text="item.label"></span>
                        </a>
                    </li>
                </template>
            </ul>
        </aside>

        <!-- Main Content -->
        <section class="flex-1 min-w-0 bg-white/80 backdrop-blur-xl rounded-2xl shadow-xl border border-gray-100 p-8 min-h-[400px]">
            <div x-show="loading" class="flex flex-col items-center justify-center min-h-[350px]">
                <span class="relative flex h-12 w-12 mb-4">
                  <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-[#DAAC40]/60 opacity-75"></span>
                  <span class="relative inline-flex rounded-full h-12 w-12 bg-[#DAAC40]"></span>
                </span>
                <p class="mt-2 text-base text-gray-500 font-medium animate-pulse">Loading section...</p>
            </div>
            <div id="account-content" x-show="!loading" class="transition-opacity duration-300"></div>
        </section>
    </div>
</div>

<!-- Alpine.js Logic -->
<script>
    function accountTabs() {
        return {
            section: 'overview',
            loading: false,
            tabs: [
                { key: 'overview', label: 'Overview', icon: 'layout-dashboard' },
                { key: 'orders', label: 'Orders', icon: 'shopping-bag' },
                { key: 'downloads', label: 'Downloads', icon: 'download' },
                { key: 'profile', label: 'Profile', icon: 'user-cog' },
                { key: 'logout', label: 'Logout', icon: 'log-out' }
            ],
            loadSection(name) {
                this.section = name;
                this.loading = true;
                fetch(`/users/account/${name}`)
                    .then(res => {
                        if (!res.ok) throw new Error('Failed to load');
                        return res.text();
                    })
                    .then(html => {
                        document.getElementById('account-content').innerHTML = html;
                        window.lucide && window.lucide.createIcons();
                    })
                    .catch(() => {
                        document.getElementById('account-content').innerHTML = 
                            '<div class="text-red-500 text-center py-8 text-lg">Failed to load section.</div>';
                    })
                    .finally(() => {
                        this.loading = false;
                    });
            },
            logout() {
                window.location.href = "/users/logout";
            }
        };
    }
    document.addEventListener('alpine:init', () => {
        window.lucide && window.lucide.createIcons();
    });
    document.addEventListener('DOMContentLoaded', () => {
        window.lucide && window.lucide.createIcons();
    });
</script>
{% endblock %}
