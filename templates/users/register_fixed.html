{% extends 'base.html' %}
{% block title %}
  Register | Super SEO Toolkit
{% endblock %}

{% block content %}
  <!-- ANIMATED GLOWING BACKGROUND BLUR -->
  <style>
    body {
      background: linear-gradient(120deg, #fffbe6 0%, #f9fafb 50%, #f6f6f8 100%);
    }
    .register-glow {
      position: absolute;
      z-index: 0;
      pointer-events: none;
      filter: blur(68px);
      opacity: 0.28;
      border-radius: 50%;
      animation: blow 6s ease-in-out infinite alternate;
    }
    .register-glow.left {
      top: 7%;
      left: 0;
      width: 350px;
      height: 240px;
      background: #daac40;
    }
    .register-glow.right {
      bottom: 8%;
      right: 0;
      width: 250px;
      height: 200px;
      background: #7f5aff;
    }
    @keyframes blow {
      0% {
        transform: scale(1);
      }
      100% {
        transform: scale(1.05);
      }
    }
  </style>
  <div class="register-glow left"></div>
  <div class="register-glow right"></div>

  <div class="min-h-screen flex items-center justify-center px-4 py-10 relative z-10">
    <div class="w-full max-w-lg mx-auto relative z-20">
      <div class="relative bg-white/90 backdrop-blur-2xl border border-gray-100 rounded-3xl shadow-2xl p-10 overflow-hidden">
        <div class="flex flex-col items-center mb-7">
          <i data-lucide="user-plus" class="lucide w-14 h-14 text-[#DAAC40] mb-4 animate-fade-in"></i>
          <h2 class="text-4xl font-extrabold text-center text-gray-900 mb-2 tracking-tight">Create your SEO Account</h2>
          <p class="text-center text-gray-500 mb-2 text-base">Unlock 250+ advanced SEO & AI tools free. Start optimizing now!</p>
        </div>

        <form method="POST" class="space-y-6" id="registerForm" autocomplete="on">
          {{ form.hidden_tag() }}

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Username -->
            <div>
              <label for="{{ form.username.id }}" class="block text-sm font-semibold text-gray-800 mb-1">{{ form.username.label.text }}</label>
              <div class="relative">
                <i data-lucide="user" class="lucide w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                {{ form.username(class='w-full pl-10 pr-3 py-3 border border-gray-200 rounded-xl shadow-sm focus:ring-2 focus:ring-[#DAAC40] focus:outline-none bg-white text-gray-900 transition-all', placeholder='Username') }}
              </div>
              {% if form.username.errors %}
                <div class="text-red-500 text-sm mt-1">
                  {% for error in form.username.errors %}
                    <p>{{ error }}</p>
                  {% endfor %}
                </div>
              {% endif %}
            </div>

            <!-- Email -->
            <div>
              <label for="{{ form.email.id }}" class="block text-sm font-semibold text-gray-800 mb-1">{{ form.email.label.text }}</label>
              <div class="relative">
                <i data-lucide="mail" class="lucide w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                {{ form.email(class='w-full pl-10 pr-3 py-3 border border-gray-200 rounded-xl shadow-sm focus:ring-2 focus:ring-[#DAAC40] focus:outline-none bg-white text-gray-900 transition-all', placeholder='Email') }}
              </div>
              {% if form.email.errors %}
                <div class="text-red-500 text-sm mt-1">
                  {% for error in form.email.errors %}
                    <p>{{ error }}</p>
                  {% endfor %}
                </div>
              {% endif %}
            </div>

            <!-- Password -->
            <div>
              <label for="{{ form.password.id }}" class="block text-sm font-semibold text-gray-800 mb-1">{{ form.password.label.text }}</label>
              <div class="relative">
                <i data-lucide="key" class="lucide w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                <input name="{{ form.password.name }}" id="{{ form.password.id }}" type="password" class="w-full pl-10 pr-12 py-3 border border-gray-200 rounded-xl shadow-sm focus:ring-2 focus:ring-[#DAAC40] focus:outline-none bg-white text-gray-900 transition-all" placeholder="Password" autocomplete="new-password" required />
                <button type="button" onclick="togglePassword('{{ form.password.id }}')" tabindex="-1" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-[#DAAC40] focus:outline-none"><i data-lucide="eye" class="lucide w-5 h-5"></i></button>
              </div>
              {% if form.password.errors %}
                <div class="text-red-500 text-sm mt-1">
                  {% for error in form.password.errors %}
                    <p>{{ error }}</p>
                  {% endfor %}
                </div>
              {% endif %}
            </div>

            <!-- Confirm Password -->
            <div>
              <label for="{{ form.confirm_password.id }}" class="block text-sm font-semibold text-gray-800 mb-1">{{ form.confirm_password.label.text }}</label>
              <div class="relative">
                <i data-lucide="shield-check" class="lucide w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                <input name="{{ form.confirm_password.name }}" id="{{ form.confirm_password.id }}" type="password" class="w-full pl-10 pr-12 py-3 border border-gray-200 rounded-xl shadow-sm focus:ring-2 focus:ring-[#DAAC40] focus:outline-none bg-white text-gray-900 transition-all" placeholder="Confirm Password" autocomplete="new-password" required />
                <button type="button" onclick="togglePassword('{{ form.confirm_password.id }}')" tabindex="-1" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-[#DAAC40] focus:outline-none"><i data-lucide="eye" class="lucide w-5 h-5"></i></button>
              </div>
              {% if form.confirm_password.errors %}
                <div class="text-red-500 text-sm mt-1">
                  {% for error in form.confirm_password.errors %}
                    <p>{{ error }}</p>
                  {% endfor %}
                </div>
              {% endif %}
            </div>
          </div>

          <!-- Terms and Conditions -->
          <div class="flex items-center">
            {{ form.terms(class='h-4 w-4 text-[#DAAC40] focus:ring-[#DAAC40] border-gray-300 rounded') }}
            <label for="{{ form.terms.id }}" class="ml-2 block text-sm text-gray-700">I agree to the <a href="{{ url_for('terms') }}" class="text-[#DAAC40] hover:underline" target="_blank">Terms of Service</a> and <a href="{{ url_for('privacy') }}" class="text-[#DAAC40] hover:underline" target="_blank">Privacy Policy</a></label>
          </div>
          {% if form.terms.errors %}
            <div class="text-red-500 text-sm mt-1">
              {% for error in form.terms.errors %}
                <p>{{ error }}</p>
              {% endfor %}
            </div>
          {% endif %}

          {% if recaptcha_site_key %}
            <div class="g-recaptcha my-2" data-sitekey="{{ recaptcha_site_key }}"></div>
          {% endif %}

          <button type="submit" class="w-full bg-[#DAAC40] text-gray-900 py-3 rounded-xl font-bold shadow-lg hover:bg-[#b89627] transition-all focus:outline-none focus:ring-2 focus:ring-[#DAAC40]/40 flex items-center justify-center gap-2"><i data-lucide="user-plus" class="lucide w-5 h-5"></i> Register for Free</button>

          <div class="flex items-center my-6">
            <span class="flex-grow border-t border-gray-200"></span>
            <span class="mx-3 text-xs text-gray-400">OR</span>
            <span class="flex-grow border-t border-gray-200"></span>
          </div>

          <a href="{{ url_for('auth.google_login') }}" class="w-full flex items-center justify-center border border-gray-300 py-2 px-4 rounded-xl text-sm font-medium bg-white hover:bg-gray-50 shadow transition mb-2"><img src="/static/img/icons8-google.svg" alt="Google" class="w-5 h-5 mr-2" /> Continue with Google</a>
        </form>

        <div class="text-center mt-4">
          <p class="text-sm text-gray-600">
            Already have an account?
            <a href="{{ url_for('users.login') }}" class="text-[#DAAC40] hover:underline font-semibold">Login</a>
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- JavaScript for password toggle -->
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
  <script>
    function togglePassword(fieldId) {
      const field = document.getElementById(fieldId)
      const button = field.nextElementSibling
      const icon = button.querySelector('i')
    
      if (field.type === 'password') {
        field.type = 'text'
        icon.setAttribute('data-lucide', 'eye-off')
      } else {
        field.type = 'password'
        icon.setAttribute('data-lucide', 'eye')
      }
    
      // Reinitialize lucide icons
      if (window.lucide) {
        window.lucide.createIcons()
      }
    }
    
    document.addEventListener('DOMContentLoaded', function () {
      // Initialize lucide icons
      if (window.lucide) {
        window.lucide.createIcons()
      }
    
      // Password validation
      const form = document.getElementById('registerForm')
      const pwd = document.getElementById('{{ form.password.id }}')
      const confirm = document.getElementById('{{ form.confirm_password.id }}')
    
      function checkStrong(val) {
        return val.length >= 8 && /[A-Z]/.test(val) && /[a-z]/.test(val) && /\d/.test(val) && /[!@#$%^&*(),.?":{}|<>]/.test(val)
      }
    
      function validate() {
        const isPasswordStrong = checkStrong(pwd.value)
        const doPasswordsMatch = pwd.value === confirm.value
    
        // Show validation feedback
        if (!isPasswordStrong) {
          pwd.classList.add('border-red-300')
          pwd.classList.remove('border-gray-200')
        } else {
          pwd.classList.add('border-green-300')
          pwd.classList.remove('border-red-300', 'border-gray-200')
        }
    
        if (!doPasswordsMatch && confirm.value.length > 0) {
          confirm.classList.add('border-red-300')
          confirm.classList.remove('border-gray-200')
        } else if (doPasswordsMatch && confirm.value.length > 0) {
          confirm.classList.add('border-green-300')
          confirm.classList.remove('border-red-300', 'border-gray-200')
        }
    
        return isPasswordStrong && doPasswordsMatch
      }
    
      if (pwd && confirm) {
        pwd.addEventListener('input', validate)
        confirm.addEventListener('input', validate)
    
        form.addEventListener('submit', function (e) {
          if (!validate()) {
            e.preventDefault()
            alert('Please ensure your password meets all requirements and passwords match.')
          }
        })
      }
    })
  </script>
{% endblock %}
