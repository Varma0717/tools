{% extends "base.html" %}

{% block title %}Pricing Plans - Super SEO Toolkit{% endblock %}
{% block meta_description %}Choose the perfect plan for your SEO needs. From free daily tools to unlimited premium access with advanced features.{% endblock %}

{% block content %}
<div class="bg-gray-50 min-h-screen py-20 px-4">
    <div class="container mx-auto max-w-7xl">
        <div class="text-center mb-12">
            <h1 class="text-5xl font-bold text-gray-800 mb-4">
                Choose Your SEO Power Level
            </h1>
            <p class="text-xl text-gray-600 mb-8 max-w-2xl mx-auto">
                Access 168+ professional SEO tools with flexible pricing that grows with your needs
            </p>
        </div>

        {% if user_stats %}
        <div class="flex justify-center mb-12">
            <div class="bg-white rounded-2xl shadow-lg p-6 w-full max-w-md">
                <h5 class="text-lg font-semibold mb-4 text-center">Your Current Usage</h5>
                {% if user_stats.type == 'anonymous' %}
                    <p class="mb-3 text-center">Daily Usage: <strong>{{ user_stats.daily_usage }}/{{ user_stats.daily_limit }}</strong></p>
                    <div class="bg-gray-200 rounded-full h-2 mb-3">
                        <div class="bg-gradient-to-r from-accent-500 to-accent-600 h-2 rounded-full transition-all duration-300" 
                             style="width: {{ (user_stats.daily_usage / user_stats.daily_limit * 100) if user_stats.daily_limit > 0 else 0 }}%"></div>
                    </div>
                    <small class="text-gray-600 text-center block">Create an account for 5 monthly uses!</small>
                {% else %}
                    {% if user_stats.is_premium %}
                        <p class="text-green-600 text-center font-semibold">✓ Unlimited Access</p>
                        <p class="text-gray-500 text-center">{{ user_stats.subscription_type|title }} Plan Active</p>
                    {% else %}
                        <p class="mb-3 text-center">Monthly Usage: <strong>{{ user_stats.monthly_usage }}/{{ user_stats.monthly_limit }}</strong></p>
                        <div class="bg-gray-200 rounded-full h-2 mb-3">
                            <div class="bg-gradient-to-r from-accent-500 to-accent-600 h-2 rounded-full transition-all duration-300" 
                                 style="width: {{ (user_stats.monthly_usage / user_stats.monthly_limit * 100) if user_stats.monthly_limit > 0 else 0 }}%"></div>
                        </div>
                        {% if user_stats.monthly_usage >= user_stats.monthly_limit %}
                            <small class="text-yellow-600 text-center block">Upgrade for unlimited access!</small>
                        {% endif %}
                    {% endif %}
                {% endif %}
            </div>
        </div>
        {% endif %}

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-12">
            <!-- Free Plan -->
            <div class="bg-white rounded-3xl shadow-2xl p-8 text-center relative hover:transform hover:-translate-y-2 transition-all duration-300">
                <div class="text-2xl font-bold text-gray-800 mb-2">Free</div>
                <div class="text-5xl font-bold text-accent-500 mb-6">
                    <span class="text-2xl align-top">$</span>0
                    <span class="text-lg text-gray-600 font-normal">/month</span>
                </div>
                <ul class="space-y-4 mb-8 text-left">
                    <li class="flex items-center text-gray-700">
                        <span class="text-green-500 font-bold mr-3">✓</span>
                        1 tool use per day (anonymous)
                    </li>
                    <li class="flex items-center text-gray-700">
                        <span class="text-green-500 font-bold mr-3">✓</span>
                        5 tools per month (with account)
                    </li>
                    <li class="flex items-center text-gray-700">
                        <span class="text-green-500 font-bold mr-3">✓</span>
                        All 168+ SEO tools available
                    </li>
                    <li class="flex items-center text-gray-700">
                        <span class="text-green-500 font-bold mr-3">✓</span>
                        Basic support
                    </li>
                    <li class="flex items-center text-gray-700">
                        <span class="text-green-500 font-bold mr-3">✓</span>
                        Community access
                    </li>
                </ul>
                {% if current_user.is_authenticated %}
                    <div class="bg-gray-500 text-white py-4 px-8 rounded-full font-semibold cursor-not-allowed">
                        Current Plan
                    </div>
                {% else %}
                    <a href="{{ url_for('users.register') }}" 
                       class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white py-4 px-8 rounded-full font-semibold transition-all duration-300 hover:shadow-lg hover:transform hover:-translate-y-1 inline-block w-full">
                        Sign Up Free
                    </a>
                {% endif %}
            </div>

            <!-- Pro Plan -->
            <div class="bg-white rounded-3xl shadow-2xl p-8 text-center relative hover:transform hover:-translate-y-2 transition-all duration-300">
                <div class="text-2xl font-bold text-gray-800 mb-2">{{ plans.pro.name }}</div>
                <div class="text-5xl font-bold text-accent-500 mb-6">
                    <span class="text-2xl align-top">$</span>{{ plans.pro.price }}
                    <span class="text-lg text-gray-600 font-normal">/month</span>
                </div>
                <ul class="space-y-4 mb-8 text-left">
                    {% for feature in plans.pro.features %}
                    <li class="flex items-center text-gray-700">
                        <span class="text-green-500 font-bold mr-3">✓</span>
                        {{ feature }}
                    </li>
                    {% endfor %}
                </ul>
                <a href="{{ url_for('pricing.subscribe', plan_type='pro') }}" 
                   class="bg-gradient-to-r from-accent-500 to-accent-600 hover:from-accent-600 hover:to-yellow-600 text-white py-4 px-8 rounded-full font-semibold transition-all duration-300 hover:shadow-lg hover:transform hover:-translate-y-1 inline-block w-full">
                    {% if current_user.is_authenticated %}
                        Upgrade to Pro
                    {% else %}
                        Start Pro Trial
                    {% endif %}
                </a>
            </div>

            <!-- Premium Plan (Most Popular) -->
            <div class="bg-white rounded-3xl shadow-2xl p-8 text-center relative hover:transform hover:-translate-y-2 transition-all duration-300 border-4 border-accent-500 transform scale-105">
                <!-- Most Popular Badge -->
                <div class="absolute -top-4 left-1/2 transform -translate-x-1/2">
                    <span class="bg-accent-500 text-white px-6 py-2 rounded-full text-sm font-bold tracking-wider">
                        MOST POPULAR
                    </span>
                </div>
                
                <div class="text-2xl font-bold text-gray-800 mb-2 mt-4">{{ plans.premium.name }}</div>
                <div class="text-5xl font-bold text-accent-500 mb-6">
                    <span class="text-2xl align-top">$</span>{{ plans.premium.price }}
                    <span class="text-lg text-gray-600 font-normal">/month</span>
                </div>
                <ul class="space-y-4 mb-8 text-left">
                    {% for feature in plans.premium.features %}
                    <li class="flex items-center text-gray-700">
                        <span class="text-green-500 font-bold mr-3">✓</span>
                        {{ feature }}
                    </li>
                    {% endfor %}
                </ul>
                <a href="{{ url_for('pricing.subscribe', plan_type='premium') }}" 
                   class="bg-gradient-to-r from-accent-500 to-accent-600 hover:from-accent-600 hover:to-yellow-600 text-white py-4 px-8 rounded-full font-semibold transition-all duration-300 hover:shadow-lg hover:transform hover:-translate-y-1 inline-block w-full">
                    {% if current_user.is_authenticated %}
                        Upgrade to Premium
                    {% else %}
                        Start Premium Trial
                    {% endif %}
                </a>
            </div>
        </div>

        <!-- Enterprise Plan (Full Width) -->
        <div class="flex justify-center mb-16">
            <div class="bg-gradient-to-r from-gray-800 to-gray-900 text-white rounded-3xl shadow-2xl p-8 w-full max-w-4xl hover:transform hover:-translate-y-2 transition-all duration-300">
                <div class="text-center mb-8">
                    <div class="text-3xl font-bold mb-2">{{ plans.enterprise.name }}</div>
                    <div class="text-5xl font-bold text-accent-500 mb-6">
                        <span class="text-2xl align-top">$</span>{{ plans.enterprise.price }}
                        <span class="text-lg text-gray-400 font-normal">/month</span>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <div>
                        <ul class="space-y-4">
                            {% for feature in plans.enterprise.features[:4] %}
                            <li class="flex items-center">
                                <span class="text-green-400 font-bold mr-3">✓</span>
                                {{ feature }}
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                    <div>
                        <ul class="space-y-4">
                            {% for feature in plans.enterprise.features[4:] %}
                            <li class="flex items-center">
                                <span class="text-green-400 font-bold mr-3">✓</span>
                                {{ feature }}
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                <div class="text-center">
                    <a href="{{ url_for('pricing.subscribe', plan_type='enterprise') }}" 
                       class="bg-gradient-to-r from-accent-500 to-accent-600 hover:from-accent-600 hover:to-yellow-600 text-white py-4 px-12 rounded-full font-semibold transition-all duration-300 hover:shadow-lg hover:transform hover:-translate-y-1 inline-block">
                        Contact Sales
                    </a>
                </div>
            </div>
        </div>

        <!-- Competitive Advantage -->
        <div class="bg-white rounded-3xl shadow-lg p-12 mb-16 text-center">
            <h3 class="text-3xl font-bold text-gray-800 mb-8">Why Choose Super SEO Toolkit?</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="text-center">
                    <div class="text-2xl font-bold text-accent-500 mb-2">168+ Tools</div>
                    <p class="text-gray-600">vs 15-20 tools in competitors</p>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-accent-500 mb-2">80% Lower Cost</div>
                    <p class="text-gray-600">vs SEOptimer & similar tools</p>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-accent-500 mb-2">All-in-One</div>
                    <p class="text-gray-600">SEO + Content + Technical + Security</p>
                </div>
            </div>
        </div>

        <!-- FAQ Section -->
        <div class="bg-white rounded-3xl shadow-lg p-12 mb-16">
            <h3 class="text-3xl font-bold text-center mb-12 text-gray-800">Frequently Asked Questions</h3>
            <div class="max-w-4xl mx-auto space-y-4">
                <div class="border border-gray-200 rounded-xl overflow-hidden">
                    <div class="p-6 cursor-pointer flex justify-between items-center hover:bg-gray-50 transition-colors" onclick="toggleFaq(this)">
                        <span class="font-semibold text-gray-800">Can I change plans anytime?</span>
                        <i class="fas fa-chevron-down transition-transform text-gray-600"></i>
                    </div>
                    <div class="faq-answer px-6 pb-6 hidden border-t border-gray-100">
                        <p class="text-gray-600 pt-4">Yes! You can upgrade, downgrade, or cancel your subscription at any time. Changes take effect at your next billing cycle.</p>
                    </div>
                </div>
                
                <div class="border border-gray-200 rounded-xl overflow-hidden">
                    <div class="p-6 cursor-pointer flex justify-between items-center hover:bg-gray-50 transition-colors" onclick="toggleFaq(this)">
                        <span class="font-semibold text-gray-800">What happens if I exceed my usage limits?</span>
                        <i class="fas fa-chevron-down transition-transform text-gray-600"></i>
                    </div>
                    <div class="faq-answer px-6 pb-6 hidden border-t border-gray-100">
                        <p class="text-gray-600 pt-4">You'll receive a friendly reminder to upgrade. Your access isn't blocked permanently - limits reset daily (free) or monthly (registered users).</p>
                    </div>
                </div>
                
                <div class="border border-gray-200 rounded-xl overflow-hidden">
                    <div class="p-6 cursor-pointer flex justify-between items-center hover:bg-gray-50 transition-colors" onclick="toggleFaq(this)">
                        <span class="font-semibold text-gray-800">Do you offer refunds?</span>
                        <i class="fas fa-chevron-down transition-transform text-gray-600"></i>
                    </div>
                    <div class="faq-answer px-6 pb-6 hidden border-t border-gray-100">
                        <p class="text-gray-600 pt-4">Yes! We offer a 30-day money-back guarantee. If you're not satisfied, contact support for a full refund.</p>
                    </div>
                </div>
                
                <div class="border border-gray-200 rounded-xl overflow-hidden">
                    <div class="p-6 cursor-pointer flex justify-between items-center hover:bg-gray-50 transition-colors" onclick="toggleFaq(this)">
                        <span class="font-semibold text-gray-800">Are there any setup fees or hidden costs?</span>
                        <i class="fas fa-chevron-down transition-transform text-gray-600"></i>
                    </div>
                    <div class="faq-answer px-6 pb-6 hidden border-t border-gray-100">
                        <p class="text-gray-600 pt-4">No hidden fees! The price you see is exactly what you pay. No setup fees, no per-tool charges, no surprises.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
// Define toggleFaq function globally and immediately
function toggleFaq(element) {
    const answer = element.nextElementSibling;
    const icon = element.querySelector('i');
    
    // Check if this FAQ is currently open
    const isOpen = !answer.classList.contains('hidden');
    
    // Close all FAQ items
    document.querySelectorAll('.faq-answer').forEach(item => {
        item.classList.add('hidden');
    });
    document.querySelectorAll('.p-6 i').forEach(iconEl => {
        iconEl.classList.remove('fa-chevron-up', 'rotate-180');
        iconEl.classList.add('fa-chevron-down');
    });
    
    // If this FAQ was closed, open it
    if (!isOpen) {
        answer.classList.remove('hidden');
        icon.classList.remove('fa-chevron-down');
        icon.classList.add('fa-chevron-up', 'rotate-180');
    }
}

// Wait for DOM to be fully loaded for other functionality
document.addEventListener('DOMContentLoaded', function() {
    // Auto-show upgrade prompts for high usage
    fetch('/api/upgrade-prompt')
        .then(response => response.json())
        .then(data => {
            if (data.show_prompt) {
                setTimeout(() => showUpgradeModal(data), 2000);
            }
        })
        .catch(err => console.log('Upgrade prompt API not available'));
});

function showUpgradeModal(data) {
    // Create Tailwind modal
    const modal = document.createElement('div');
    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
    modal.innerHTML = `
        <div class="bg-white rounded-2xl p-8 max-w-md mx-4 text-center">
            <h5 class="text-xl font-bold mb-4">${data.title}</h5>
            <p class="text-gray-600 mb-6">${data.message}</p>
            <div class="flex gap-3 justify-center">
                <a href="${data.primary_action.url}" class="bg-accent-500 hover:bg-accent-600 text-white px-6 py-2 rounded-lg font-semibold transition-colors">
                    ${data.primary_action.text}
                </a>
                <a href="${data.secondary_action.url}" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-6 py-2 rounded-lg font-semibold transition-colors">
                    ${data.secondary_action.text}
                </a>
                <button onclick="this.closest('.fixed').remove()" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-6 py-2 rounded-lg font-semibold transition-colors">
                    Later
                </button>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    
    // Close on background click
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            modal.remove();
        }
    });
}
</script>
{% endblock %}
