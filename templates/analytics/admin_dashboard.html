{% extends 'base.html' %}

{% block title %}
  Admin Dashboard - Super SEO Toolkit
{% endblock %}

{% block head %}
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background: radial-gradient(ellipse at top left, #fffbe6 0%, #f6f6f8 80%), linear-gradient(135deg, #daac42 0%, #f1eaff 100%);
      min-height: 100vh;
      position: relative;
    }
    .glow-blur {
      position: absolute;
      z-index: 0;
      pointer-events: none;
      filter: blur(64px);
      opacity: 0.2;
      border-radius: 50%;
      animation: blow 8s ease-in-out infinite alternate;
    }
    @keyframes blow {
      0% {
        transform: scale(1);
      }
      100% {
        transform: scale(1.05);
      }
    }
    .glow-blur.admin-one {
      top: 10%;
      right: 5%;
      width: 300px;
      height: 200px;
      background: #daac42;
    }
    .glow-blur.admin-two {
      bottom: 20%;
      left: 5%;
      width: 250px;
      height: 150px;
      background: #7f5aff;
    }
  </style>
  <div class="glow-blur admin-one"></div>
  <div class="glow-blur admin-two"></div>
{% endblock %}

{% block content %}
  <div class="max-w-7xl mx-auto px-6 py-16 relative z-10">
    <!-- Header -->
    <div class="mb-12 text-center">
      <div class="inline-block rounded-full px-5 py-1 text-xs font-bold bg-[#DAAC40]/10 text-[#DAAC40] tracking-widest shadow-sm mb-4 uppercase">Admin Panel</div>
      <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 mb-4">Analytics Dashboard</h1>
      <p class="text-xl text-gray-600 max-w-2xl mx-auto">Monitor your SEO toolkit performance and manage business metrics</p>
    </div>

    <!-- Key Metrics -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-12">
      <div class="bg-white/90 rounded-2xl shadow-xl p-8 border border-gray-100 hover:border-[#DAAC40] transition-all duration-200 group">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm font-medium text-gray-600 mb-2">Total Users</p>
            <p class="text-3xl font-bold text-gray-900" id="total-users">-</p>
          </div>
          <div class="bg-[#DAAC40]/10 p-4 rounded-full group-hover:bg-[#DAAC40]/20 transition-colors">
            <i data-lucide="users" class="lucide w-8 h-8 text-[#DAAC40] group-hover:scale-110 transition-transform"></i>
          </div>
        </div>
        <div class="mt-6 flex items-center">
          <span class="text-green-600 text-sm font-semibold" id="users-growth">+0%</span>
          <span class="text-gray-500 text-sm ml-2">vs last month</span>
        </div>
      </div>

      <div class="bg-white/90 rounded-2xl shadow-xl p-8 border border-gray-100 hover:border-[#DAAC40] transition-all duration-200 group">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm font-medium text-gray-600 mb-2">Active Subscribers</p>
            <p class="text-3xl font-bold text-gray-900" id="active-subscribers">-</p>
          </div>
          <div class="bg-[#DAAC40]/10 p-4 rounded-full group-hover:bg-[#DAAC40]/20 transition-colors">
            <i data-lucide="credit-card" class="lucide w-8 h-8 text-[#DAAC40] group-hover:scale-110 transition-transform"></i>
          </div>
        </div>
        <div class="mt-6 flex items-center">
          <span class="text-green-600 text-sm font-semibold" id="subscribers-growth">+0%</span>
          <span class="text-gray-500 text-sm ml-2">vs last month</span>
        </div>
      </div>

      <div class="bg-white/90 rounded-2xl shadow-xl p-8 border border-gray-100 hover:border-[#DAAC40] transition-all duration-200 group">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm font-medium text-gray-600 mb-2">Monthly Revenue</p>
            <p class="text-3xl font-bold text-gray-900" id="monthly-revenue">$-</p>
          </div>
          <div class="bg-green-100 p-4 rounded-full group-hover:bg-green-200 transition-colors">
            <i data-lucide="dollar-sign" class="lucide w-8 h-8 text-green-600 group-hover:scale-110 transition-transform"></i>
          </div>
        </div>
        <div class="mt-6 flex items-center">
          <span class="text-green-600 text-sm font-semibold" id="revenue-growth">+0%</span>
          <span class="text-gray-500 text-sm ml-2">vs last month</span>
        </div>
      </div>

      <div class="bg-white/90 rounded-2xl shadow-xl p-8 border border-gray-100 hover:border-[#DAAC40] transition-all duration-200 group">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm font-medium text-gray-600 mb-2">SEO Tools Used</p>
            <p class="text-3xl font-bold text-gray-900" id="daily-usage">-</p>
          </div>
          <div class="bg-purple-100 p-4 rounded-full group-hover:bg-purple-200 transition-colors">
            <i data-lucide="wrench" class="lucide w-8 h-8 text-purple-600 group-hover:scale-110 transition-transform"></i>
          </div>
        </div>
        <div class="mt-6 flex items-center">
          <span class="text-green-600 text-sm font-semibold" id="usage-growth">+0%</span>
          <span class="text-gray-500 text-sm ml-2">vs yesterday</span>
        </div>
      </div>
    </div>

    <div class="grid lg:grid-cols-2 gap-12 mb-12">
      <!-- Revenue Chart -->
      <div class="bg-white/90 rounded-2xl shadow-xl p-8 border border-gray-100 hover:border-[#DAAC40] transition-all duration-200">
        <h3 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
          <i data-lucide="trending-up" class="lucide w-6 h-6 text-[#DAAC40] mr-3"></i>
          Revenue Trend
        </h3>
        <canvas id="revenueChart" height="300"></canvas>
      </div>

      <!-- User Growth Chart -->
      <div class="bg-white/90 rounded-2xl shadow-xl p-8 border border-gray-100 hover:border-[#DAAC40] transition-all duration-200">
        <h3 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
          <i data-lucide="user-plus" class="lucide w-6 h-6 text-[#DAAC40] mr-3"></i>
          User Growth
        </h3>
        <canvas id="userGrowthChart" height="300"></canvas>
      </div>
    </div>

    <div class="grid lg:grid-cols-3 gap-8 mb-12">
      <!-- Top SEO Tools -->
      <div class="bg-white/90 rounded-2xl shadow-xl p-8 border border-gray-100 hover:border-[#DAAC40] transition-all duration-200">
        <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
          <i data-lucide="wrench" class="lucide w-5 h-5 text-[#DAAC40] mr-3"></i>
          Most Used SEO Tools
        </h3>
        <div class="space-y-4" id="top-tools">
          <div class="animate-pulse">
            <div class="h-4 bg-gray-200 rounded w-3/4 mb-2"></div>
            <div class="h-2 bg-gray-200 rounded w-1/2"></div>
          </div>
        </div>
      </div>

      <!-- Subscription Plans -->
      <div class="bg-white/90 rounded-2xl shadow-xl p-8 border border-gray-100 hover:border-[#DAAC40] transition-all duration-200">
        <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
          <i data-lucide="pie-chart" class="lucide w-5 h-5 text-[#DAAC40] mr-3"></i>
          Subscription Distribution
        </h3>
        <canvas id="subscriptionChart" height="200"></canvas>
      </div>

      <!-- Recent Activity -->
      <div class="bg-white/90 rounded-2xl shadow-xl p-8 border border-gray-100 hover:border-[#DAAC40] transition-all duration-200">
        <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
          <i data-lucide="clock" class="lucide w-5 h-5 text-[#DAAC40] mr-3"></i>
          Recent Activity
        </h3>
        <div class="space-y-3" id="recent-activity">
          <div class="animate-pulse">
            <div class="h-3 bg-gray-200 rounded w-full mb-2"></div>
            <div class="h-3 bg-gray-200 rounded w-2/3"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="bg-white/90 rounded-2xl shadow-xl p-8 border border-gray-100">
      <h3 class="text-2xl font-bold text-gray-900 mb-8 text-center">Quick Actions</h3>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
        <a href="{{ url_for('admin.users') }}" class="group bg-gray-50 border border-gray-100 hover:border-[#DAAC40] p-6 rounded-2xl shadow hover:shadow-xl transition-all flex flex-col items-center">
          <i data-lucide="users" class="lucide w-10 h-10 mb-3 text-[#DAAC40] group-hover:scale-110 transition-transform"></i>
          <span class="font-semibold text-gray-900 group-hover:text-[#DAAC40] text-center">Manage Users</span>
        </a>

        <a href="{{ url_for('subscription.plans') }}" class="group bg-gray-50 border border-gray-100 hover:border-[#DAAC40] p-6 rounded-2xl shadow hover:shadow-xl transition-all flex flex-col items-center">
          <i data-lucide="credit-card" class="lucide w-10 h-10 mb-3 text-[#DAAC40] group-hover:scale-110 transition-transform"></i>
          <span class="font-semibold text-gray-900 group-hover:text-[#DAAC40] text-center">Subscription Plans</span>
        </a>

        <a href="{{ url_for('admin.posts') }}" class="group bg-gray-50 border border-gray-100 hover:border-[#DAAC40] p-6 rounded-2xl shadow hover:shadow-xl transition-all flex flex-col items-center">
          <i data-lucide="edit" class="lucide w-10 h-10 mb-3 text-[#DAAC40] group-hover:scale-110 transition-transform"></i>
          <span class="font-semibold text-gray-900 group-hover:text-[#DAAC40] text-center">Blog Posts</span>
        </a>

        <a href="{{ url_for('admin.settings') }}" class="group bg-gray-50 border border-gray-100 hover:border-[#DAAC40] p-6 rounded-2xl shadow hover:shadow-xl transition-all flex flex-col items-center">
          <i data-lucide="settings" class="lucide w-10 h-10 mb-3 text-[#DAAC40] group-hover:scale-110 transition-transform"></i>
          <span class="font-semibold text-gray-900 group-hover:text-[#DAAC40] text-center">Settings</span>
        </a>
      </div>
    </div>
  </div>

  <script>
    // Chart configurations with consistent color scheme
    Chart.defaults.font.family = 'Inter, system-ui, sans-serif'
    Chart.defaults.color = '#6B7280'
    
    // Revenue Chart
    const revenueCtx = document.getElementById('revenueChart').getContext('2d')
    const revenueChart = new Chart(revenueCtx, {
      type: 'line',
      data: {
        labels: [],
        datasets: [
          {
            label: 'Revenue ($)',
            data: [],
            borderColor: '#DAAC40',
            backgroundColor: 'rgba(218, 172, 64, 0.1)',
            tension: 0.4,
            fill: true,
            borderWidth: 3,
            pointBackgroundColor: '#DAAC40',
            pointBorderColor: '#ffffff',
            pointBorderWidth: 2,
            pointRadius: 6,
            pointHoverRadius: 8
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            grid: {
              color: 'rgba(0, 0, 0, 0.05)',
              borderDash: [5, 5]
            },
            ticks: {
              callback: function (value) {
                return '$' + value
              }
            }
          },
          x: {
            grid: {
              display: false
            },
            ticks: {
              color: '#6B7280'
            }
          }
        }
      }
    })
    
    // User Growth Chart
    const userCtx = document.getElementById('userGrowthChart').getContext('2d')
    const userChart = new Chart(userCtx, {
      type: 'bar',
      data: {
        labels: [],
        datasets: [
          {
            label: 'New Users',
            data: [],
            backgroundColor: 'rgba(218, 172, 64, 0.8)',
            borderColor: '#DAAC40',
            borderWidth: 2,
            borderRadius: 8,
            borderSkipped: false
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            grid: {
              color: 'rgba(0, 0, 0, 0.05)',
              borderDash: [5, 5]
            }
          },
          x: {
            grid: {
              display: false
            }
          }
        }
      }
    })
    
    // Subscription Distribution Chart
    const subCtx = document.getElementById('subscriptionChart').getContext('2d')
    const subscriptionChart = new Chart(subCtx, {
      type: 'doughnut',
      data: {
        labels: ['Free', 'Pro', 'Enterprise'],
        datasets: [
          {
            data: [0, 0, 0],
            backgroundColor: ['#6B7280', '#DAAC40', '#059669'],
            borderColor: '#ffffff',
            borderWidth: 3,
            hoverOffset: 8
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'bottom',
            labels: {
              padding: 20,
              usePointStyle: true,
              font: {
                size: 12,
                weight: '500'
              }
            }
          }
        }
      }
    })
    
    // Load dashboard data
    async function loadDashboardData() {
      try {
        const response = await fetch('/analytics/api/admin-stats')
        if (response.ok) {
          const data = await response.json()
    
          // Update metrics
          document.getElementById('total-users').textContent = data.total_users || 0
          document.getElementById('active-subscribers').textContent = data.active_subscribers || 0
          document.getElementById('monthly-revenue').textContent = `$${data.monthly_revenue || 0}`
          document.getElementById('daily-usage').textContent = data.daily_usage || 0
    
          // Update growth indicators
          document.getElementById('users-growth').textContent = `+${data.users_growth || 0}%`
          document.getElementById('subscribers-growth').textContent = `+${data.subscribers_growth || 0}%`
          document.getElementById('revenue-growth').textContent = `+${data.revenue_growth || 0}%`
          document.getElementById('usage-growth').textContent = `+${data.usage_growth || 0}%`
    
          // Update charts
          if (data.revenue_data) {
            revenueChart.data.labels = data.revenue_data.labels
            revenueChart.data.datasets[0].data = data.revenue_data.values
            revenueChart.update()
          }
    
          if (data.user_growth_data) {
            userChart.data.labels = data.user_growth_data.labels
            userChart.data.datasets[0].data = data.user_growth_data.values
            userChart.update()
          }
    
          if (data.subscription_distribution) {
            subscriptionChart.data.datasets[0].data = data.subscription_distribution
            subscriptionChart.update()
          }
    
          // Update top tools
          if (data.top_tools) {
            const topToolsContainer = document.getElementById('top-tools')
            topToolsContainer.innerHTML = data.top_tools
              .map(
                (tool) => `
                            <div class="flex items-center justify-between">
                                <span class="text-sm font-medium text-gray-700">${tool.name}</span>
                                <span class="text-sm text-gray-500">${tool.usage}</span>
                            </div>
                        `
              )
              .join('')
          }
    
          // Update recent activity
          if (data.recent_activity) {
            const activityContainer = document.getElementById('recent-activity')
            activityContainer.innerHTML = data.recent_activity
              .map(
                (activity) => `
                            <div class="text-sm text-gray-600">${activity}</div>
                        `
              )
              .join('')
          }
        }
      } catch (error) {
        console.error('Failed to load dashboard data:', error)
      }
    }
    
    // Initialize dashboard
    document.addEventListener('DOMContentLoaded', function () {
      loadDashboardData()
    
      // Refresh data every 5 minutes
      setInterval(loadDashboardData, 300000)
    })
  </script>
{% endblock %}
