{% extends "base.html" %}

{% block title %}{{ post.meta_title or post.title }} - Super SEO Toolkit{% endblock %}

{% block meta_description %}{{ post.meta_description or (post.excerpt|truncate(155) if post.excerpt else post.title) }}{% endblock %}

{% block meta_keywords %}{{ post.meta_keywords or (post.tags | map(attribute='name') | join(', ')) }}{% endblock %}

{% block content %}
<section class="relative py-20 bg-white min-h-screen overflow-hidden">
  <!-- Glowing Background Accent -->
  <div aria-hidden="true" class="absolute top-[-100px] left-1/2 -translate-x-1/2 w-[500px] h-[500px] rounded-full bg-[#DAAC42]/20 blur-3xl animate-pulse"></div>

  <div class="max-w-4xl mx-auto px-6 relative z-10">
    <!-- Post Header -->
    <header class="text-center mb-16 space-y-6">
      <!-- Breadcrumbs -->
      <nav aria-label="Breadcrumb" class="text-sm text-gray-500 mb-4">
        <ol class="flex justify-center items-center space-x-2">
          <li><a href="{{ url_for('blog.blog_index') }}" class="hover:text-[#DAAC42] transition">Blog</a></li>
          {% if post.categories %}
          <li class="flex items-center space-x-2">
            <span>•</span>
            <a href="{{ url_for('blog.category_posts', slug=post.categories[0].slug) }}" 
               class="hover:text-[#DAAC42] transition">{{ post.categories[0].name }}</a>
          </li>
          {% endif %}
          <li class="flex items-center space-x-2">
            <span>•</span>
            <span class="text-gray-400">{{ post.title[:30] }}...</span>
          </li>
        </ol>
      </nav>

      <!-- Categories and Status -->
      <div class="flex flex-wrap justify-center gap-2 mb-4">
        {% if post.status == 'draft' %}
        <span class="bg-yellow-500/20 text-yellow-700 px-3 py-1 rounded-full text-sm font-medium">
          <i data-lucide="edit" class="w-4 h-4 inline mr-1"></i>Draft
        </span>
        {% endif %}
        {% if post.featured %}
        <span class="bg-red-500/20 text-red-700 px-3 py-1 rounded-full text-sm font-medium">
          <i data-lucide="star" class="w-4 h-4 inline mr-1"></i>Featured
        </span>
        {% endif %}
        {% for category in post.categories %}
        <a href="{{ url_for('blog.category_posts', slug=category.slug) }}"
           class="bg-[#DAAC42]/20 text-[#DAAC42] hover:bg-[#DAAC42]/30 px-3 py-1 rounded-full text-sm font-medium transition flex items-center gap-1">
          {% if category.icon %}
          <i data-lucide="{{ category.icon }}" class="w-4 h-4"></i>
          {% endif %}
          {{ category.name }}
        </a>
        {% endfor %}
      </div>

      <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 leading-tight tracking-tight">
        {{ post.title }}
      </h1>

      {% if post.excerpt %}
      <p class="text-xl text-gray-600 max-w-3xl mx-auto leading-relaxed">
        {{ post.excerpt }}
      </p>
      {% endif %}

      <div class="flex flex-wrap justify-center items-center gap-6 text-sm text-gray-500 font-medium">
        <div class="flex items-center gap-2">
          <!-- Author SVG Icon -->
          <div class="w-8 h-8 bg-[#DAAC42]/20 rounded-full flex items-center justify-center">
            <svg class="w-5 h-5 text-[#DAAC42]" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
            </svg>
          </div>
          <span class="text-gray-700">{{ post.display_author or 'Super SEO Toolkit' }}</span>
        </div>

        <span aria-hidden="true" class="text-gray-400">•</span>

        <time datetime="{{ post.published_at.isoformat() if post.published_at else post.created_at.isoformat() }}"
              class="flex items-center gap-1 text-gray-600">
          <i data-lucide="calendar" class="w-4 h-4 text-[#DAAC42]"></i>
          {{ post.published_at.strftime('%B %d, %Y') if post.published_at else post.created_at.strftime('%B %d, %Y') }}
        </time>

        {% if post.view_count %}
        <span aria-hidden="true" class="text-gray-400">•</span>
        <span class="flex items-center gap-1 text-gray-600">
          <i data-lucide="eye" class="w-4 h-4 text-[#DAAC42]"></i>
          {{ post.view_count }} views
        </span>
        {% endif %}

        {% if post.reading_time %}
        <span aria-hidden="true" class="text-gray-400">•</span>
        <span class="flex items-center gap-1 text-gray-600">
          <i data-lucide="clock" class="w-4 h-4 text-[#DAAC42]"></i>
          {{ post.reading_time }} min read
        </span>
        {% endif %}
      </div>
    </header>
    <!-- Featured Image -->
    {% if post.featured_image %}
    <figure class="mb-12 rounded-3xl overflow-hidden shadow-2xl ring-4 ring-[#DAAC42]/30 hover:ring-[#DAAC42]/50 transition duration-500">
      <img 
        src="{{ url_for('static', filename='uploads/' ~ post.featured_image) }}"
        alt="{{ post.title }}"
        class="w-full object-cover max-h-[480px]"
        loading="lazy"
        decoding="async"
      />
    </figure>
    {% endif %}

    <!-- Tags Section -->
    {% if post.tags %}
    <div class="mb-8 text-center">
      <div class="flex flex-wrap justify-center gap-2">
        {% for tag in post.tags %}
        <a href="{{ url_for('blog.tag_posts', slug=tag.slug) }}"
           class="inline-flex items-center gap-1 bg-gray-100 hover:bg-[#DAAC42]/20 text-gray-700 hover:text-[#DAAC42] 
                  px-3 py-1 rounded-full text-sm transition">
          <i data-lucide="tag" class="w-3 h-3"></i>
          {{ tag.name }}
        </a>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <!-- Post Content -->
    <article
      class="prose prose-lg max-w-none mx-auto text-gray-800
             prose-a:text-[#DAAC42] prose-a:no-underline prose-a:hover:underline
             prose-img:rounded-xl prose-img:shadow-lg prose-img:my-8
             prose-blockquote:border-l-4 prose-blockquote:border-[#DAAC42]
             prose-blockquote:bg-[#fef8dc] prose-blockquote:px-6 prose-blockquote:py-4 prose-blockquote:italic
             prose-h2:text-2xl prose-h2:font-bold prose-h2:text-gray-900 prose-h2:mt-8 prose-h2:mb-4
             prose-h3:text-xl prose-h3:font-semibold prose-h3:text-gray-800 prose-h3:mt-6 prose-h3:mb-3
             sm:prose-lg md:prose-xl"
    >
      {{ post.content | safe }}
    </article>

    <!-- Related Posts -->
    {% if related_posts %}
    <section class="mt-16 border-t border-gray-200 pt-12">
      <h2 class="text-2xl font-bold text-gray-900 mb-8 text-center">Related Posts</h2>
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for related_post in related_posts %}
        <a href="{{ url_for('blog.view_post', slug=related_post.slug) }}"
           class="group flex flex-col bg-white rounded-xl border border-gray-200 hover:border-[#DAAC42]/50 
                  overflow-hidden shadow-md hover:shadow-lg transition-all duration-300">
          {% if related_post.featured_image %}
          <div class="h-32 overflow-hidden">
            <img src="{{ url_for('static', filename='images/' ~ related_post.featured_image) }}"
                 alt="{{ related_post.title }}"
                 class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300" />
          </div>
          {% endif %}
          <div class="p-4 flex-grow">
            <h3 class="font-semibold text-gray-900 group-hover:text-[#DAAC42] line-clamp-2 mb-2 transition">
              {{ related_post.title }}
            </h3>
            {% if related_post.excerpt %}
            <p class="text-sm text-gray-600 line-clamp-2">
              {{ related_post.excerpt }}
            </p>
            {% endif %}
            <div class="mt-3 flex items-center justify-between text-xs text-gray-500">
              <span>{{ related_post.published_at.strftime('%b %d, %Y') if related_post.published_at else related_post.created_at.strftime('%b %d, %Y') }}</span>
              {% if related_post.view_count %}
              <span class="flex items-center gap-1">
                <i data-lucide="eye" class="w-3 h-3"></i>
                {{ related_post.view_count }}
              </span>
              {% endif %}
            </div>
          </div>
        </a>
        {% endfor %}
      </div>
    </section>
    {% endif %}

    <!-- Navigation -->
    <div class="mt-16 flex flex-col sm:flex-row justify-between items-center gap-4">
      <a href="{{ url_for('blog.blog_index') }}"
         class="inline-flex items-center gap-2 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium 
                px-6 py-3 rounded-xl transition"
         aria-label="Back to blog listing">
         <i data-lucide="arrow-left" class="w-5 h-5"></i> 
         Back to Blog
      </a>
      
      {% if post.categories %}
      <a href="{{ url_for('blog.category_posts', slug=post.categories[0].slug) }}"
         class="inline-flex items-center gap-2 bg-[#DAAC42] hover:bg-[#b89627] text-white font-medium 
                px-6 py-3 rounded-xl transition"
         aria-label="More posts in {{ post.categories[0].name }}">
         <i data-lucide="grid" class="w-5 h-5"></i> 
         More in {{ post.categories[0].name }}
      </a>
      {% endif %}
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    if (window.lucide) {
      window.lucide.createIcons();
    }

    // Track page view (if analytics are enabled)
    {% if post.id %}
    fetch('{{ url_for("blog.track_view", post_id=post.id) }}', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      }
    }).catch(err => console.log('View tracking failed:', err));
    {% endif %}

    // Smooth scroll for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      });
    });
  });
</script>
{% endblock %}
